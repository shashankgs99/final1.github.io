"use strict";!function(){angular.module("app").controller("AppGlobalController",["$scope","$http","$timeout","$ocLazyLoad","$injector","$location","$window","$state","$filter","$log","$stateParams",function($scope,$http,$timeout,$ocLazyLoad,$injector,$location,$window,$state,$filter,$log,$stateParams){$ocLazyLoad.load("/assets/js/bower/ngprogress.min.js").then(function(){var ngProgressFactory=$injector.get("ngProgressFactory");$scope.progressbar=ngProgressFactory.createInstance(),$scope.progressbar.start(),$timeout(function(){$scope.progressbar.complete()},3e3)}),$scope.$state=$state,$ocLazyLoad.load("/assets/js/services/user-service.js").then(function(){function getCurrentUser(source){$scope.current_user.data={},$scope.current_user.token=UserService.getDataFromLocalStorage("token"),UserService.getCurrentUser().then(function(data){if(!data.data||!data.data.id){var redirectUrl=redirectUrls.filter(function(url){return window.location.pathname.contains(url)});return void(redirectUrl.length&&$window.open($state.href("login.default",{redirectUrl:window.location.pathname}),"_self"))}$scope.current_user.data=data.data,$scope.current_user.data.image_url=$scope.current_user.data.image_url?$scope.current_user.data.image_url:"/assets/img/user-img.png",$scope.current_user.data.dashboards&&$scope.current_user.data.dashboards.length&&$scope.current_user.data.dashboards.map(function(record){"Supplier"==record.name&&($scope.current_user.data.is_seller=!0),"Buyer"==record.name&&($scope.current_user.data.is_buyer=!0),"Store"==record.name&&($scope.current_user.data.is_store=!0),"Finance"==record.name&&($scope.current_user.data.is_finance=!0)}),mixpanel.identify($scope.current_user.data.id),mixpanel.people.set({$email:$scope.current_user.data.email,$created:$scope.current_user.data.created,organization:$scope.current_user.data.company?$scope.current_user.data.company.company_name:""}),$zopim(function(){$zopim.livechat.setName($scope.current_user.data.first_name),$zopim.livechat.setEmail($scope.current_user.data.email)}),zE(function(){zE.identify({name:$scope.current_user.data.first_name,email:$scope.current_user.data.email,organization:$scope.current_user.data.company?$scope.current_user.data.company.company_name:""})})})["catch"](function(response){})}var UserService=$injector.get("UserService");$scope.current_user={},$scope.getAccountHref=function(){$scope.current_user.data.is_superuser?$state.go("adminDashboard.myAccount.view"):$scope.current_user.data.is_superuser||$scope.current_user.data.is_seller?$state.go("supplierDashboard.myAccount.view"):($scope.current_user.data.is_superuser||$scope.current_user.data.is_buyer)&&$state.go("buyerDashboard.myAccount.view")},$scope.current_user.logout=function(route){UserService.deleteTokenFromLocalStorage(),UserService.logout().then(function(data){route?$window.location.assign(route):$window.location.assign("/")},function(err){})},$scope.getCompany=function(){$state.current.name.includes("adminDashboard")||($state.current.name.includes("supplierDashboard")?$state.go("supplierDashboard.company.view"):$state.current.name.includes("buyerDashboard")&&$state.go("buyerDashboard.company.view"))},$scope.getTeam=function(){$state.current.name.includes("adminDashboard")||($state.current.name.includes("supplierDashboard")?$state.go("supplierDashboard.team"):$state.current.name.includes("buyerDashboard")?$state.go("buyerDashboard.team"):$state.current.name.includes("marketDashboard")?$state.go("marketDashboard.team"):$state.current.name.includes("storeDashboard")&&$state.go("storeDashboard.team"))},$scope.getMessages=function(){$state.current.name.includes("adminDashboard")||($state.current.name.includes("supplierDashboard")&&$state.go("supplierDashboard.Messages"),$state.current.name.includes("buyerDashboard")?$state.go("buyerDashboard.Messages"):$state.current.name.includes("marketDashboard")?$state.go("marketDashboard.Messages"):$state.current.name.includes("storeDashboard")&&$state.go("storeDashboard.Messages"))};var redirectUrls=["/admin-dashboard","/supplier-dashboard","/buyer-dashboard","/market-dashboard","/stores-dashboard","/finance-dashboard"];getCurrentUser()})}])}();