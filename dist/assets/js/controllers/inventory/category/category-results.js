"use strict";!function(){var app=angular.module("app");app.controller("inventoryList.category.results",["$scope","$window","$timeout","ParentCategoryService","CategoryService","InventoryService","hotRegisterer","CityService","$stateParams","MessageService","$modal","$log","Notification",function($scope,$window,$timeout,ParentCategoryService,CategoryService,InventoryService,hotRegisterer,CityService,$stateParams,MessageService,$modal,$log,Notification){function getGridOptions(){return{enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi,gridApi.selection.on.rowSelectionChanged($scope,function(rows){$scope.mySelections=gridApi.selection.getSelectedRows(),console.log($scope.mySelections)})},enablePaginationControls:!0,paginationPageSize:25,paginationPageSizes:[25,50,75],enableFiltering:!0,enableGridMenu:!0,enableRowSelection:!0,enableSelectAll:!0,selectionRowHeaderWidth:35,multiSelect:!0,scrollingHorizontally:!0,rowIdentity:function(row){return row.id},exporterLinkLabel:"get your csv here",exporterMenuPdf:!1,exporterMenuCsv:!1,exporterPdfDefaultStyle:{fontSize:8},exporterPdfTableStyle:{margin:[30,30,30,30]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfOrientation:"portrait",exporterPdfPageSize:"A2",exporterFieldCallback:function(grid,row,col,input){if("string"===col.colDef.type)return input;switch(col.colDef.type){case"date":return moment(input).format("YYYY-MM-DD");default:return input}},columnDefs:[],data:[]}}function UserId(){var userId=$scope.current_user.data.id;return userId}function SelectedInventories(){return $scope.mySelections}function open(size,myMessage,backdrop,itemCount,closeOnClick){size="large";var params={templateUrl:"popup.html",resolve:{items:function(){return $scope.items}},controller:function($scope,$modalInstance,items,Notification){$scope.tinymceOptions={plugins:"link image code media table paste",toolbar:"undo redo | bold italic | alignleft aligncenter alignright | code"},tinymce.init({selector:"#mytextarea",width:"700",height:"700",menubar:!0,plugins:["advlist autolink lists link image charmap print preview anchor textcolor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste code help wordcount"],toolbar:"insert | undo redo |  formatselect | bold italic backcolor  | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",content_css:["//fonts.googleapis.com/css?family=Lato:300,300i,400,400i","//www.tinymce.com/css/codepen.min.css"]});var inventoriesData=SelectedInventories();$scope.colheaders=["Id","Title","Description","Category Tree","Material","Grade","Standard","Available Quantity","Unit Of Measure","Unit Price","Currency","Supplier","Manfacturer/Make"];var dataArray=myMessage?[myMessage]:inventoriesData,result=_.groupBy(dataArray,"supplier_id");$scope.inventoryArr=[];for(var key in result){var item={};item.message="",item.inventories=result[key],item.supplierId=key,result[key]&&(item.message='<br/><br/><table border="1"><thead><tr>',$scope.colheaders.forEach(function(header){item.message+='<th style="padding: 5px; border: 1px solid #999; background: #ccc;">'+header+"</th>"}),item.message+="</tr></thead>",item.message+="<tbody>",result[key].forEach(function(value){item.message+='<tr><td style="padding: 5px; border: 1px solid #999;">'+value.id+'</td><td style="padding: 5px; border: 1px solid #999;">'+value.title+'</td><td style="padding: 5px; border: 1px solid #999;">'+value.description+'</td><td style="padding: 5px; border: 1px solid #999;">'+value.category+'</td><td style="padding: 5px; border: 1px solid #999;">'+value.material+'</td><td style="padding: 5px; border: 1px solid #999;">'+value.grade+'</td><td style="padding: 5px; border: 1px solid #999;">'+value.standard+'</td><td style="padding: 5px; border: 1px solid #999;">'+value.available_quantity+'</td><td style="padding: 5px; border: 1px solid #999;">'+value.unit_of_measure+'</td><td style="padding: 5px; border: 1px solid #999;">'+value.unit_price+'</td><td style="padding: 5px; border: 1px solid #999;">'+value.currency+'</td><td style="padding: 5px; border: 1px solid #999;">'+value.supplier+'</td><td style="padding: 5px; border: 1px solid #999;">'+value.manufacturer+"</td></tr>"}),item.message+="</tbody>",item.message+="</table>"),$scope.inventoryArr.push(item)}var Id=UserId();Id?($scope.showEmail=!1,$scope.showMobile=!1,$scope.showId=!0):($scope.showEmail=!0,$scope.showMobile=!0,$scope.showId=!1),$scope.reposition=function(){$modalInstance.reposition()},$scope.SelectedRows=function(sender_email,sender_mobile,message){var sender_id=Id?Id:null,messages=[];for(var data in message){var inventoryId=message[data].inventories;messages.push({sender:sender_id,sender_email:sender_email,sender_mobile:sender_mobile,message:message[data].message,inventory:inventoryId.map(function(item){return item.id}),supplier:message[data].supplierId}),MessageService.post(messages).then(function(result){$modalInstance.dismiss("cancel"),Notification.success({message:"Message Sent",positionX:"right",positionY:"top"}),$timeout(function(){$window.location.reload()},3e3)})}},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.openNested=function(){open()}}};angular.isDefined(closeOnClick)&&(params.closeOnClick=closeOnClick),angular.isDefined(size)&&(params.size=size),angular.isDefined(backdrop)&&(params.backdrop=backdrop);var modalInstance=$modal.open(params);modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})}$scope.params={},$scope.showEmail=!1,$scope.showMobile=!1,$scope.categoryDataLoaded=!1,ParentCategoryService.getById($scope.$stateParams.categoryId).then(function(data){$scope.category=data.data,$scope.categoryDataLoaded=!0,$scope.params.category_name=$scope.category.category_name,$stateParams.sub_category&&($scope.params.sub_category=$stateParams.sub_category);var reqParams={};reqParams.parent_category__category_name=$scope.category.category_name,$stateParams.rental?(reqParams.stock_or_inventory="Rental",$scope.params.stock_or_inventory="Rental"):(reqParams.stock_or_inventory={value:"Rental",operator:"!="},$scope.params.stock_or_inventory={value:"Rental",operator:"!="})}),$scope.gridOptions=getGridOptions(),$scope.cellClicked=function(attachments){function open(size,attachments,closeOnClick){$scope.attachments=attachments;var params={templateUrl:"myModalContent.html",resolve:{attachments:function(){return $scope.attachments}},controller:function($scope,$modalInstance,attachments){$scope.attachments=attachments,console.log($scope.attachments);var attachmentNames=[];$scope.attachments.forEach(function(item){var splitArray=item.split("/"),fileName=splitArray.splice(splitArray.length-1,1);attachmentNames.push(fileName[0])}),$scope.attachmentNames=attachmentNames,$scope.reposition=function(){$modalInstance.reposition()},$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.openNested=function(){open()}}};angular.isDefined(closeOnClick)&&(params.closeOnClick=closeOnClick),angular.isDefined(size)&&(params.size=size);var modalInstance=$modal.open(params);modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})}open("small",attachments)},$scope.open=open;var myText='<div ng-show="this.COL_FIELD.length" class="button-container"><a ng-click="grid.appScope.cellClicked(this.COL_FIELD)" class="ui-grid-cell-contents download-button" title="TOOLTIP">Download</a></div>',myTitle='<div class="ui-grid-cell-contents" title="{{row.entity.title}}">{{row.entity.title}}</div>',myDescription='<div class="ui-grid-cell-contents" title="{{row.entity.description}}">{{row.entity.description}}</div>',unitPriceVarTemp='<a ng-click="grid.appScope.open(large, row.entity)" class="special-anchor-button ui-grid-cell-contents download-button" title="TOOLTIP">{{row.entity.unit_price?row.entity.unit_price:row.entity.unit_price === null && row.entity.supplier?"Contact Supplier":"Contact Admin"}} </a>',availQuantityVarTemp="";availQuantityVarTemp=$stateParams.rental?'<a ng-click="grid.appScope.open(large, row.entity)" class="special-anchor-button ui-grid-cell-contents download-button" title="TOOLTIP">{{row.entity.available_quantity==0?"Rented":row.entity.available_quantity === null && row.entity.supplier?"Contact Supplier":row.entity.available_quantity}} </a>':'<a ng-click="grid.appScope.open(large, row.entity)" class="special-anchor-button ui-grid-cell-contents download-button" title="TOOLTIP">{{row.entity.available_quantity==0?"Contact Supplier":row.entity.available_quantity}} </a>',$scope.gridOptions.columnDefs=[{name:"id",displayName:"ID",width:50,enableCellEdit:!1,pinnedLeft:!0,enableSorting:!0},{field:"title",displayName:"Title",width:200,pinnedLeft:!0,enableSorting:!0,cellTemplate:myTitle},{field:"description",displayName:"Description",width:150,pinnedLeft:!0,enableSorting:!0,cellTemplate:myDescription},{field:"category",displayName:"Category Tree",width:150,enableSorting:!0},{field:"available_quantity",displayName:"Available Quantity",cellFilter:"number:0",width:150,pinnedLeft:!0,enableSorting:!0,cellTemplate:availQuantityVarTemp},{field:"unit_of_measure",displayName:"Unit Of Measure",width:100,pinnedLeft:!0,enableSorting:!0},{field:"unit_price",displayName:"Unit Price",width:150,pinnedLeft:!0,enableSorting:!0,cellTemplate:unitPriceVarTemp},{field:"currency",displayName:"Currency",width:75,pinnedLeft:!0,enableSorting:!0},{field:"manufacturer",displayName:"Manufacturer/Make",width:175,pinnedLeft:!0,enableSorting:!0},{field:"attachments",displayName:"Attachments",width:150,pinnedLeft:!0,enableSorting:!0,cellTemplate:myText}]}])}();