"use strict";!function(){var app=angular.module("app");app.controller("dashboard.controller",["$scope","$window","$injector","$rootScope","$mdDialog",function($scope,$window,$injector,$rootScope,$mdDialog){$scope.iconData=!1,$scope.inventoryIconData=!1,$scope.diaData=!1,$scope.proIconData=!1,$injector.loadNewModules(["ngHandsontable"]),$injector.loadNewModules(["mm.foundation"]),$injector.loadNewModules(["angular.filter"]),$scope.windowInnerHeight={height:window.innerHeight+"px"};var innerHeight=window.innerHeight-window.innerHeight/3;$scope.leftNavigationHeight={height:innerHeight+"px",overflow:"auto","padding-bottom":"50px"},setTimeout(function(){var element=angular.element(document.querySelectorAll(".header-bar"));element&&element[0]&&($rootScope.topPosition={top:element[0].offsetHeight+"px"})},500),innerWidth<576?$rootScope.toggle=!1:$rootScope.toggle=!0,$scope.toggleClick=function(toggle){return $rootScope.toggle=!toggle},$scope.changeIcon=function(ev){$scope.current_user.data&&$scope.current_user.data.company&&$mdDialog.show({templateUrl:"assets/partials/dashboard/supplier/change-logo.html",controller:"changeIconController",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,locals:{$dialogScope:{company:$scope.current_user.data.company,user:$scope.current_user.data}}}).then(function(res){res&&($scope.current_user.data.company.logo=res.logo)})},$scope.stopVideo=function(video_id){var iframe=document.getElementById(video_id).contentWindow;iframe.postMessage('{"event":"command","func":"stopVideo","args":""}',"*"),"company-video"===video_id?$scope.companyVideo=!1:"directory-video"===video_id?$scope.directoryVideo=!1:"inventory-video"===video_id&&($scope.inventoryVideo=!1)},$scope.startVideo=function(video_id){"company-video"===video_id?($scope.companyVideo=!0,$scope.directoryVideo=!1,$scope.inventoryVideo=!1,$scope.productProfileSection=!1,$scope.inventoryInstructions=!1):"directory-video"===video_id?($scope.directoryVideo=!0,$scope.companyVideo=!1,$scope.productProfileSection=!1,$scope.inventoryVideo=!1,$scope.inventoryInstructions=!1):"inventory-video"===video_id&&($scope.inventoryVideo=!0,$scope.directoryVideo=!1,$scope.productProfileSection=!1,$scope.companyVideo=!1)},$scope.Introduction=function(introduction_type){"inventory-introduction"===introduction_type?($scope.inventoryInstructions=!$scope.inventoryInstructions,$scope.productProfileSection=!1,$scope.directoryVideo=!1):"product-introduction"===introduction_type&&($scope.productProfileSection=!$scope.productProfileSection,$scope.inventoryInstructions=!1,$scope.inventoryVideo=!1)},$scope.openInventoryInstructions=function(){$scope.inventoryInstructions=!$scope.inventoryInstructions,$scope.productProfileSection=!1},$scope.openProductInstructions=function(){$scope.productProfileSection=!$scope.productProfileSection,$scope.inventoryInstructions=!1},$scope.myFunction=function(){var popup=document.getElementById("myPopup");$scope.productProfileSection=!0,popup.classList.toggle("show"),$scope.companyVideo=!1}}]).controller("dashboard.admin.inventory",["$scope","$interval","ParentCategoryService","IndustryService","CsvService","InventoryService","Notification","$state",function($scope,$interval,ParentCategoryService,IndustryService,CsvService,InventoryService,Notification,$state){window.innerWidth>425&&($scope.hideMore=!0),console.log("From Admin > inventory"),$scope.selected={},$scope.documentTitle="",$scope.fileAttachments,$scope.productImages,$scope.addInventories=function(){$state.go("adminDashboard.inventory.addMultipleInventories")},$scope.addInventory=function(){$state.go("adminDashboard.inventory.add")},$scope.editInventory=function(table_changes){return $scope.inventoryItem=table_changes,0===table_changes.length?void Notification.error({message:"Please select atleast one item to edit",positionX:"right",positionY:"top"}):table_changes.length>1?void Notification.error({message:"Please select one item to edit",positionX:"right",positionY:"top"}):void $state.go("adminDashboard.inventory.edit",{inventoryId:table_changes[0][4]})},$scope.viewInventory=function(table_changes){return 0===table_changes.length?void Notification.error({message:"Please select atleast one item to view",positionX:"right",positionY:"top"}):table_changes.length>1?void Notification.error({message:"Please select one item to view",positionX:"right",positionY:"top"}):void $state.go("adminDashboard.inventory.details",{itemId:table_changes[0][4]})},$scope.cancelEdit=function(){$state.go("adminDashboard.inventory.list")},$scope.Industry=function(selectedIndustry,selectedItemtype){1===selectedIndustry?$scope.industry=selectedItemtype:2===selectedIndustry&&($scope.item=selectedItemtype),CsvService.importData($scope.industry,$scope.item)},IndustryService.get().then(function(data){$scope.selectedIndustry=[],$scope.allIndustries=data.data.results,$scope.allIndustries=$scope.allIndustries.map(function(item){return{id:item.id,label:item.industry}}),$scope.allIndustries.unshift({id:0,label:"Not Applicable"})},function(error){console.log(error)}),$scope.selectEvents={onItemSelect:function(item){0===item.id&&($scope.allIndustries=$scope.allIndustries.map(function(item){return"Not Applicable"!==item.label&&(item.disabled=!0),item}),$scope.selectedIndustry=[{id:0,label:"Not Applicable"}])},onItemDeselect:function(item){0===item.id&&($scope.allIndustries=$scope.allIndustries.map(function(item){return"Not Applicable"!==item.label&&(item.disabled=!1),item}))}},InventoryService.getInventoryCategoryNames({supplier:null}).then(function(data){$scope.categories=data.data.map(function(item){return{category_name:item}}),$scope.isCategoryLoaded=!0})}]).controller("dashboard.admin.directory",["$scope","$interval","Notification","IndustryService","CsvService","InventoryService","$state",function($scope,$interval,Notification,IndustryService,CsvService,InventoryService,$state){console.log("From Admin > inventory"),$scope.documentTitle="",window.innerWidth>425&&($scope.hideMore=!0),$scope.editDirectory=function(table_changes){return 0===table_changes.length?void Notification.error({message:"Please select atleast one item to edit",positionX:"right",positionY:"top"}):table_changes.length>1?void Notification.error({message:"Please select one item to edit",positionX:"right",positionY:"top"}):void $state.go("adminDashboard.directory.edit",{directoryId:table_changes[0][4]})},$scope.cancelEdit=function(){$state.go("adminDashboard.directory.list")},$scope.addDirectory=function(){$state.go("adminDashboard.directory.add")},$scope.viewDirectory=function(table_changes){return 0===table_changes.length?void Notification.error({message:"Please select atleast one item to view",positionX:"right",positionY:"top"}):table_changes.length>1?void Notification.error({message:"Please select one item to view",positionX:"right",positionY:"top"}):void $state.go("adminDashboard.directory.view",{itemId:table_changes[0][4]})},$scope.addProducts=function(){$state.go("adminDashboard.directory.addMultipleProducts")},$scope.Industry=function(selectedIndustry,selectedItemtype){1===selectedIndustry?$scope.industry=selectedItemtype:2===selectedIndustry&&($scope.item=selectedItemtype),CsvService.importData($scope.industry,$scope.item)},IndustryService.get().then(function(data){$scope.selectedIndustry=[],$scope.allIndustries=data.data.results,$scope.allIndustries=$scope.allIndustries.map(function(item){return{id:item.id,label:item.industry}}),$scope.allIndustries.unshift({id:0,label:"Not Applicable"})},function(error){console.log(error)}),$scope.selectEvents={onItemSelect:function(item){0===item.id&&($scope.allIndustries=$scope.allIndustries.map(function(item){return"Not Applicable"!==item.label&&(item.disabled=!0),item}),$scope.selectedIndustry=[{id:0,label:"Not Applicable"}])},onItemDeselect:function(item){0===item.id&&($scope.allIndustries=$scope.allIndustries.map(function(item){return"Not Applicable"!==item.label&&(item.disabled=!1),item}))}}}]).controller("dashboard.supplier.inventory",["$scope","$interval","$modal","ParentCategoryService","InventoryService","IndustryService","CsvService","Notification","$state",function($scope,$interval,$modal,ParentCategoryService,InventoryService,IndustryService,CsvService,Notification,$state){function open(size,backdrop,itemCount,closeOnClick,type){var templateModal;templateModal="add"==type?"userNoteModal.html":"instructionsModal.html",$scope.items=[];for(var count=itemCount||3,i=0;i<count;i++)$scope.items.push("item "+i);var params={templateUrl:templateModal,resolve:{items:function(){return $scope.items}},controller:function($scope,$modalInstance,items){$scope.items=items,$scope.selected={item:$scope.items[0]},$scope.reposition=function(){$modalInstance.reposition()},$scope.ok=function(){$modalInstance.close($scope.selected.item)},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.openNested=function(){open()}}};angular.isDefined(closeOnClick)&&(params.closeOnClick=closeOnClick),angular.isDefined(size)&&(params.size=size),angular.isDefined(backdrop)&&(params.backdrop=backdrop);var modalInstance=$modal.open(params);modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})}console.log("From Supplier > inventory"),$scope.selected={},$scope.documentTitle="",$scope.hideMore=!0,$scope.Industry=function(selectedIndustry,selectedItemtype){1===selectedIndustry?$scope.industry=selectedItemtype:2===selectedIndustry&&($scope.item=selectedItemtype),CsvService.importData($scope.industry,$scope.item)},IndustryService.get().then(function(data){$scope.selectedIndustry=[],$scope.allIndustries=data.data.results,$scope.allIndustries=$scope.allIndustries.map(function(item){return{id:item.id,label:item.industry}}),$scope.allIndustries.unshift({id:0,label:"Not Applicable"})},function(error){console.log(error)}),$scope.selectEvents={onItemSelect:function(item){0===item.id&&($scope.allIndustries=$scope.allIndustries.map(function(item){return"Not Applicable"!==item.label&&(item.disabled=!0),item}),$scope.selectedIndustry=[{id:0,label:"Not Applicable"}])},onItemDeselect:function(item){0===item.id&&($scope.allIndustries=$scope.allIndustries.map(function(item){return"Not Applicable"!==item.label&&(item.disabled=!1),item}))}},$scope.current_user.data.company?InventoryService.getInventoryCategoryNames({company:$scope.current_user.data.company.id}).then(function(data){$scope.categories=data.data.map(function(item){return{category_name:item}}),$scope.isCategoryLoaded=!0}):$scope.current_user.data.is_superuser&&ParentCategoryService.get().then(function(data){$scope.categories=data.data.results,$scope.isCategoryLoaded=!0},function(err){console.log(err)}),$scope.showSupplierAdmin=!1,$scope.current_user.data.is_admin_supplier||$scope.current_user.data.is_superuser?$scope.showSupplierAdmin=!0:$scope.showSupplierAdmin=!1,$scope.open=open,$scope.editInventory=function(table_changes){return $scope.inventoryItem=table_changes,0===table_changes.length?void Notification.error({message:"Please select atleast one item to edit",positionX:"right",positionY:"top"}):table_changes.length>1?void Notification.error({message:"Please select one item to edit",positionX:"right",positionY:"top"}):void $state.go("marketDashboard.inventory.edit",{inventoryId:table_changes[0][4]})},$scope.addInventory=function(){$state.go("marketDashboard.inventory.add")},$scope.addMulInventories=function(){$state.go("marketDashboard.inventory.addMultipleInventories")},$scope.viewInventory=function(table_changes){return 0===table_changes.length?void Notification.error({message:"Please select atleast one item to view",positionX:"right",positionY:"top"}):table_changes.length>1?void Notification.error({message:"Please select one item to view",positionX:"right",positionY:"top"}):void $state.go("marketDashboard.inventory.details",{itemId:table_changes[0][4]})},$scope.cancelEdit=function(){$state.go("marketDashboard.inventory.list")}}]).controller("dashboard.supplier.rental",["$scope","$interval","$modal","ParentCategoryService","InventoryService","IndustryService","CsvService","Notification","$state",function($scope,$interval,$modal,ParentCategoryService,InventoryService,IndustryService,CsvService,Notification,$state){function open(size,backdrop,itemCount,closeOnClick,type){var templateModal;templateModal="add"==type?"userNoteModal.html":"instructionsModal.html",$scope.items=[];for(var count=itemCount||3,i=0;i<count;i++)$scope.items.push("item "+i);var params={templateUrl:templateModal,resolve:{items:function(){return $scope.items}},controller:function($scope,$modalInstance,items){$scope.items=items,$scope.selected={item:$scope.items[0]},$scope.reposition=function(){$modalInstance.reposition()},$scope.ok=function(){$modalInstance.close($scope.selected.item)},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.openNested=function(){open()}}};angular.isDefined(closeOnClick)&&(params.closeOnClick=closeOnClick),angular.isDefined(size)&&(params.size=size),angular.isDefined(backdrop)&&(params.backdrop=backdrop);var modalInstance=$modal.open(params);modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})}console.log("From Supplier > inventory"),$scope.selected={},$scope.documentTitle="",$scope.hideMore=!0,$scope.Industry=function(selectedIndustry,selectedItemtype){1===selectedIndustry?$scope.industry=selectedItemtype:2===selectedIndustry&&($scope.item=selectedItemtype),CsvService.importData($scope.industry,$scope.item)},IndustryService.get().then(function(data){$scope.selectedIndustry=[],$scope.allIndustries=data.data.results,$scope.allIndustries=$scope.allIndustries.map(function(item){return{id:item.id,label:item.industry}}),$scope.allIndustries.unshift({id:0,label:"Not Applicable"})},function(error){console.log(error)}),$scope.selectEvents={onItemSelect:function(item){0===item.id&&($scope.allIndustries=$scope.allIndustries.map(function(item){return"Not Applicable"!==item.label&&(item.disabled=!0),item}),$scope.selectedIndustry=[{id:0,label:"Not Applicable"}])},onItemDeselect:function(item){0===item.id&&($scope.allIndustries=$scope.allIndustries.map(function(item){return"Not Applicable"!==item.label&&(item.disabled=!1),item}))}},$scope.current_user.data.company?InventoryService.getInventoryCategoryNames({company:$scope.current_user.data.company.id}).then(function(data){$scope.categories=data.data.map(function(item){return{category_name:item}}),$scope.isCategoryLoaded=!0}):$scope.current_user.data.is_superuser&&ParentCategoryService.get().then(function(data){$scope.categories=data.data.results,$scope.isCategoryLoaded=!0},function(err){console.log(err)}),$scope.showSupplierAdmin=!1,$scope.current_user.data.is_admin_supplier||$scope.current_user.data.is_superuser?$scope.showSupplierAdmin=!0:$scope.showSupplierAdmin=!1,$scope.open=open,$scope.editRental=function(table_changes){return $scope.inventoryItem=table_changes,0===table_changes.length?void Notification.error({message:"Please select atleast one item to edit",positionX:"right",positionY:"top"}):table_changes.length>1?void Notification.error({message:"Please select one item to edit",positionX:"right",positionY:"top"}):void $state.go("marketDashboard.rental.edit",{inventoryId:table_changes[0][4]})},$scope.addRental=function(){$state.go("marketDashboard.rental.add")},$scope.addMulRentals=function(){$state.go("marketDashboard.rental.addMultipleRentals")},$scope.viewRental=function(table_changes){return 0===table_changes.length?void Notification.error({message:"Please select atleast one item to view",positionX:"right",positionY:"top"}):table_changes.length>1?void Notification.error({message:"Please select one item to view",positionX:"right",positionY:"top"}):void $state.go("marketDashboard.rental.details",{itemId:table_changes[0][4]})},$scope.cancelEdit=function(){$state.go("marketDashboard.rental.list")}}]).controller("dashboard.supplier.directory",["$scope","$interval","DirectoryService","$modal","IndustryService","CsvService","Notification","$state","$log",function($scope,$interval,DirectoryService,$modal,IndustryService,CsvService,Notification,$state,$log){function open(size,backdrop,itemCount,closeOnClick,type){var templateModal;templateModal="add"==type?"userNoteModal.html":"instructionsModal.html",$scope.items=[];for(var count=itemCount||3,i=0;i<count;i++)$scope.items.push("item "+i);var params={templateUrl:templateModal,resolve:{items:function(){return $scope.items}},controller:function($scope,$modalInstance,items){$scope.items=items,$scope.selected={item:$scope.items[0]},$scope.reposition=function(){$modalInstance.reposition()},$scope.ok=function(){$modalInstance.close($scope.selected.item)},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.openNested=function(){open()}}};angular.isDefined(closeOnClick)&&(params.closeOnClick=closeOnClick),angular.isDefined(size)&&(params.size=size),angular.isDefined(backdrop)&&(params.backdrop=backdrop);var modalInstance=$modal.open(params);modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})}$scope.directory={},$scope.hideMore=!0,$scope.isDirectorySubsLoaded=!1,$scope.isDirectorynotSubsLoaded=!1,$scope.current_user.data.company&&DirectoryService.get({company__company_name:$scope.current_user.data.company.company_name}).then(function(data){$scope.directory.subscribed=data.data,$scope.isDirectorySubsLoaded=!0}),$scope.current_user.data.company&&DirectoryService.get({"company__company_name!":$scope.current_user.data.company.company_name}).then(function(data){$scope.directory.notSubscribed=data.data,$scope.isDirectorynotSubsLoaded=!0}),$scope.documentTitle="",$scope.Industry=function(selectedIndustry,selectedItemtype){1===selectedIndustry?$scope.industry=selectedItemtype:2===selectedIndustry&&($scope.item=selectedItemtype),CsvService.importData($scope.industry,$scope.item)},IndustryService.get().then(function(data){$scope.selectedIndustry=[],$scope.allIndustries=data.data.results,$scope.allIndustries=$scope.allIndustries.map(function(item){return{id:item.id,label:item.industry}}),$scope.allIndustries.unshift({id:0,label:"Not Applicable"})},function(error){console.log(error)}),$scope.selectEvents={onItemSelect:function(item){0===item.id&&($scope.allIndustries=$scope.allIndustries.map(function(item){return"Not Applicable"!==item.label&&(item.disabled=!0),item}),$scope.selectedIndustry=[{id:0,label:"Not Applicable"}])},onItemDeselect:function(item){0===item.id&&($scope.allIndustries=$scope.allIndustries.map(function(item){return"Not Applicable"!==item.label&&(item.disabled=!1),item}))}},$scope.editDirectory=function(table_changes){return 0===table_changes.length?void Notification.error({message:"Please select atleast one item to edit",positionX:"right",positionY:"top"}):table_changes.length>1?void Notification.error({message:"Please select one item to edit",positionX:"right",positionY:"top"}):void $state.go("marketDashboard.directory.edit",{directoryId:table_changes[0][4]})},$scope.viewDirectory=function(table_changes){return 0===table_changes.length?void Notification.error({message:"Please select atleast one item to view",positionX:"right",positionY:"top"}):table_changes.length>1?void Notification.error({message:"Please select one item to view",positionX:"right",positionY:"top"}):void $state.go("marketDashboard.directory.view",{itemId:table_changes[0][4]})},$scope.addMulProducts=function(){$state.go("marketDashboard.directory.addMultipleProducts")},$scope.addDirectory=function(){$state.go("marketDashboard.directory.add")},$scope.cancelEdit=function(){$state.go("marketDashboard.directory.list")},$scope.showSupplierAdmin=!1,$scope.current_user.data.is_admin_supplier||$scope.current_user.data.is_superuser?$scope.showSupplierAdmin=!0:$scope.showSupplierAdmin=!1,$scope.open=open}]).controller("dashboard.supplier.team",["$scope","$interval","DirectoryService","$modal","$log","$http","$injector","UserService",function($scope,$interval,DirectoryService,$modal,$log,$http,$injector,UserService){function currentUser(){return $scope.current_user.data}function open(size,message,backdrop,itemCount,closeOnClick){var params={templateUrl:"addTeam.html",resolve:{items:function(){return $scope.items}},controller:function($scope,$modalInstance,items,$http,$injector,Notification){$scope.Submit=function(data,valid_data){if(valid_data){var userEmail=data.email,userName=data.name,admin=currentUser();$http.get("/sendgrid/verify-team-member/",{params:{userEmail:userEmail,userName:userName,companyId:admin.company.id,company:admin.company.company_name,companyAdmin:admin.first_name+" "+admin.last_name}}).then(function(response){$modalInstance.dismiss("cancel"),Notification.success({message:"Sent email to the Email Address specified",positionX:"right",positionY:"top"})})["catch"](function(error){$modalInstance.dismiss("cancel"),Notification.error({message:"Something went wrong. Please try again.",positionX:"right",positionY:"top"})})}},$scope.reposition=function(){$modalInstance.reposition()},$scope.ok=function(){$modalInstance.close($scope.selected.item)},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.openNested=function(){open()}}};angular.isDefined(closeOnClick)&&(params.closeOnClick=closeOnClick),angular.isDefined(size)&&(params.size=size),angular.isDefined(backdrop)&&(params.backdrop=backdrop);var modalInstance=$modal.open(params);modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})}$scope.members=[],$scope.current_user.data.company&&UserService.get({company:$scope.current_user.data.company.id}).then(function(data){$scope.members=data.data.results.filter(function(member){return member.is_admin_supplier===!1})}),currentUser(),$scope.open=open}]).controller("dashboard.admin.city",["$scope","$interval","Notification","$state","CityService","CityDraftService","$mdDialog",function($scope,$interval,Notification,$state,CityService,CityDraftService,$mdDialog){function saveCities(data,draft_item){CityService.post(data).then(function(res){draft_item.city_ref=res.data.id,CityDraftService.update(draft_item.id,draft_item).then(function(res){Notification.success({message:"Successfully Updated",positionX:"right",positionY:"top"}),refreshData()})})}function refreshData(){$scope.uiGridOptions.data=$scope.uiGridOptions.data.map(function(item){return item.checked=!1,item})}function getRowId(row){return row.id}function SaveLinkedCities(records,city){var saved=[],cityItems=[];$scope.cityDraftData.filter(function(item){records.map(function(rec){rec.id==item.id&&(item.city_ref=city.id,cityItems.push(item))})}),cityItems.map(function(item){CityDraftService.update(item.id,item).then(function(res){saved.push(res.data),saved.length==cityItems.length&&(Notification.success({message:"Successfully Updated",positionX:"right",positionY:"top"}),refreshData())})})}$scope.addCity=function(){var selected=[],updateItems=[],saved=[],draft_item={};return $scope.uiGridOptions.data.map(function(item){if(item.checked){item.changed&&(item.city_ref||delete item.city_ref,updateItems.push(angular.copy(item))),item.city_ref&&delete item.city_ref;var newCityFromDraft={city:item.city,state:item.state,country:item.country};draft_item=item,selected.push(newCityFromDraft)}}),selected.length<1||selected.length>1?void Notification.error({message:"please select one city",positionX:"right",positionY:"top"}):(1==selected.length&&saveCities(selected[0],draft_item),void(updateItems.length&&updateItems.map(function(rec){CityDraftService.update(rec.id,rec).then(function(res){saved.push(res.data),saved.length==updateItems.length&&(Notification.success({message:"Successfully Updated",positionX:"right",positionY:"top"}),refreshData())})})))},CityDraftService.get().then(function(res){$scope.cityDraftData=res.data.results,$scope.uiGridOptions.data=res.data.results}),$scope.uiGridOptions={enableCellEditOnFocus:!0,enableColumnResizing:!0,enableFiltering:!0,enableGridMenu:!0,showGridFooter:!0,showColumnFooter:!0,fastWatch:!0,rowIdentity:getRowId,getRowIdentity:getRowId,importerDataAddCallback:function(grid,newObjects){$scope.myData=$scope.data.concat(newObjects)},columnDefs:[{name:"checked",width:50,displayName:"",cellTemplate:'<input type="checkbox" ng-model="row.entity.checked">'},{name:"id",displayName:"#",width:50,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"city",displayName:"City",width:150,pinnedLeft:!0,enableCellEdit:!0,enableSorting:!0},{field:"state",displayName:"State",width:200,pinnedLeft:!0,enableCellEdit:!0,enableSorting:!0},{field:"country",displayName:"Country",width:150,pinnedLeft:!0,enableCellEdit:!0,enableSorting:!0},{field:"city_ref",displayName:"City ID#",width:150,pinnedLeft:!0,enableCellEdit:!0,enableSorting:!0}],onRegisterApi:function(registeredApi){$scope.gridApi=registeredApi,$scope.gridApi.edit.on.afterCellEdit($scope,function(rowEntity,colDef,newValue,oldValue){"city"==colDef.name&&(rowEntity.changed=!0),"state"==colDef.name&&(rowEntity.changed=!0),"country"==colDef.name&&(rowEntity.changed=!0),newValue!=oldValue&&(rowEntity.modified=!0)})}},$scope.link=function(ev){var selected=[];return $scope.uiGridOptions.data.map(function(item){item.checked&&selected.push(item)}),selected.length<1?void Notification.error({message:"please select city",positionX:"right",positionY:"top"}):void(selected.length>=1&&$mdDialog.show({controller:"dashboard.admin.linkCityController",templateUrl:"assets/partials/dashboard/admin/link-city.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,locals:{$dialogScope:{data:selected}}}).then(function(res){res&&SaveLinkedCities(selected,res)},function(){}))}}]).controller("dashboard.admin.linkCityController",["$scope","$mdDialog","Notification","$state","CityService","CityDraftService","$q","$dialogScope","$timeout",function($scope,$mdDialog,Notification,$state,CityService,CityDraftService,$q,$dialogScope,$timeout){function CreateFilterFor(query){var lowercaseQuery=query.toLowerCase();return function(item){var result=item.city.toLowerCase();return 0===result.indexOf(lowercaseQuery)}}CityService.get().then(function(res){$scope.cities=res.data.results}),$scope.selectedItem=null,$scope.searchText=null,$scope.querySearch=function(query){var results=query?$scope.cities.filter(CreateFilterFor(query)):$scope.cities,deferred=$q.defer();return $timeout(function(){deferred.resolve(results)},1e3*Math.random(),!1),deferred.promise},$scope.cancel=function(){$mdDialog.cancel()},$scope.save=function(data){$mdDialog.hide($scope.selectedItem)},$scope.selectedCityDraft=$dialogScope.data}])}();