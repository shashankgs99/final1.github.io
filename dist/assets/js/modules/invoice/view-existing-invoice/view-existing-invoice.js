"use strict";!function(){var app=angular.module("app");app.controller("layout.standard.viewInvoiceItems",["$scope","$window","$mdDialog","$log","$state","Notification","MessageService","$http","s3Service","dateService","$rootScope","$timeout","$stateParams","MTOService","MTOOfferService","$dialogScope","CompanyService","$filter",function($scope,$window,$mdDialog,$log,$state,Notification,MessageService,$http,s3Service,dateService,$rootScope,$timeout,$stateParams,MTOService,MTOOfferService,$dialogScope,CompanyService,$filter){function getRowId(row){return row.id}function CalculateTax(item){var totalTax=null;return item.cgst_value&&(totalTax=parseFloat(item.cgst_value)),item.sgst_value&&(totalTax=totalTax?parseFloat(totalTax)+parseFloat(item.sgst_value):parseFloat(item.sgst_value)),item.igst_value&&!totalTax&&(totalTax=parseFloat(item.igst_value)),item.vat_value&&!totalTax&&(totalTax=parseFloat(item.vat_value)),item.other_charges_value&&(totalTax=totalTax?parseFloat(totalTax)+parseFloat(item.other_charges_value):parseFloat(item.other_charges_value)),totalTax}$scope.uiGridOptions={data:$dialogScope.items,enableCellEditOnFocus:!0,enableColumnResizing:!0,enableFiltering:!0,enableGridMenu:!0,showGridFooter:!0,showColumnFooter:!0,fastWatch:!0,rowIdentity:getRowId,getRowIdentity:getRowId,importerDataAddCallback:function(grid,newObjects){$scope.myData=$scope.data.concat(newObjects)},columnDefs:[{name:"checked",displayName:"",cellTemplate:'<input type="checkbox" ng-model="row.entity.checked">'},{name:"s_no",displayName:"S.No",width:50,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"details",displayName:"Details of Payment",width:200,pinnedLeft:!0,enableCellEdit:!0,enableSorting:!0},{field:"quantity",displayName:"Quantity",width:100,pinnedLeft:!0,enableCellEdit:!0,enableSorting:!0},{field:"item_price",displayName:"Item Price",width:100,pinnedLeft:!0,enableCellEdit:!0,enableSorting:!0},{field:"total_price",displayName:"Value",width:150,pinnedLeft:!0,enableSorting:!1,enableCellEdit:!1},{field:"igst_value",displayName:"IGST",width:100,pinnedLeft:!0,enableCellEdit:!0},{field:"cgst_value",displayName:"CGST",width:100,pinnedLeft:!0,enableCellEdit:!0},{field:"sgst_value",displayName:"SGST",width:100,pinnedLeft:!0,enableCellEdit:!0},{field:"vat_value",displayName:"VAT",width:100,pinnedLeft:!0,enableCellEdit:!0},{field:"other_charges_value",displayName:"Other Charges",width:200,pinnedLeft:!0,enableCellEdit:!0},{field:"total_price_with_tax",displayName:"Total Price with tax",width:200,pinnedLeft:!0,enableCellEdit:!0}],onRegisterApi:function(registeredApi){$scope.gridApi=registeredApi,$scope.gridApi.edit.on.afterCellEdit($scope,function(rowEntity,colDef,newValue,oldValue){if("quantity"==colDef.name){rowEntity.item_price&&(rowEntity.total_price=parseInt(newValue)*parseInt(rowEntity.item_price));var taxvalue=CalculateTax(rowEntity);rowEntity.total_price_with_tax=parseFloat(taxvalue)+parseFloat(rowEntity.total_price)}if("item_price"==colDef.name){rowEntity.quantity&&(rowEntity.total_price=parseInt(newValue)*parseInt(rowEntity.quantity));var taxvalue=CalculateTax(rowEntity);rowEntity.total_price_with_tax=parseFloat(taxvalue)+parseFloat(rowEntity.total_price)}if("cgst_value"==colDef.name||"sgst_value"==colDef.name||"igst_value"==colDef.name||"vat_value"==colDef.name||"other_charges_value"==colDef.name){var gst;newValue>oldValue&&(gst=parseFloat(newValue)-parseFloat(oldValue),rowEntity.total_price_with_tax=parseFloat(rowEntity.total_price_with_tax)+parseFloat(gst)),newValue<oldValue&&(gst=parseFloat(oldValue)-parseFloat(newValue),rowEntity.total_price_with_tax=parseFloat(rowEntity.total_price_with_tax)-parseFloat(gst))}newValue!=oldValue&&(rowEntity.modified=!0)})}},$scope["delete"]=function(){var deletedItems=[];return $dialogScope.items.map(function(item){item.checked&&deletedItems.push(item.id)}),deletedItems.length?void $mdDialog.hide({type:"delete",data:deletedItems}):void Notification.error({message:"Please select items to delete",positionX:"right",positionY:"top"})},$scope.save=function(){var modifiedItems=[];$dialogScope.items.map(function(item){item.modified&&modifiedItems.push(item)}),modifiedItems.length&&$mdDialog.hide({type:"modify",data:modifiedItems})},$scope.cancel=function(){$mdDialog.cancel()}}]).controller("layout.standard.viewInvoiceItemList",["$scope","$window","$mdDialog","$log","$state","Notification","MessageService","$http","s3Service","dateService","$rootScope","$timeout","$stateParams","MTOService","MTOOfferService","$dialogScope","CompanyService","$filter",function($scope,$window,$mdDialog,$log,$state,Notification,MessageService,$http,s3Service,dateService,$rootScope,$timeout,$stateParams,MTOService,MTOOfferService,$dialogScope,CompanyService,$filter){$scope.showBtn=!1,$scope.showColumn=$dialogScope.showColumn,$dialogScope.items=$dialogScope.items.map(function(item,$index){return"item_number"in item.so_item&&(item.so_serial_number=Number(item.so_item.item_number.split("-").pop().split("_").pop())),item.index=$index+1,item}),$scope.uiGridOptions={data:$dialogScope.items,enableCellEditOnFocus:!0,enableColumnResizing:!0,enableFiltering:!0,enableGridMenu:!0,showGridFooter:!0,showColumnFooter:!0,fastWatch:!0,columnDefs:[{name:"index",displayName:"S.No",width:50,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"so_serial_number",displayName:"SO #",width:100,pinnedLeft:!0,enableCellEdit:!0},{field:"so_item.customer_po_number",displayName:"Customer PO S.NO#",width:100,pinnedLeft:!0,enableCellEdit:!0},{field:"details",displayName:"Details of Payment",width:200,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"quantity",displayName:"Quantity",width:100,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"item_price",displayName:"Item Price",width:100,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"total_price",displayName:"Value",width:150,pinnedLeft:!0,enableSorting:!1,enableCellEdit:!1},{field:"vat_value",displayName:"VAT",width:100,pinnedLeft:!0,enableCellEdit:!1},{field:"other_charges_value",displayName:"Other Charges",width:200,pinnedLeft:!0,enableCellEdit:!1},{field:"total_price_with_tax",displayName:"Total Price with tax",width:200,pinnedLeft:!0,enableCellEdit:!1}]},$scope.cancel=function(){$mdDialog.cancel()}}])}();