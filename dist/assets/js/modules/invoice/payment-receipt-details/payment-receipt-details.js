"use strict";!function(){angular.module("app").controller("layout.standard.paymentReceiptController",["$scope","dateService","CompanyService","$state","Notification","$dialogScope","InvoiceService","$stateParams","$mdDialog","$q","BankService",function($scope,dateService,CompanyService,$state,Notification,$dialogScope,InvoiceService,$stateParams,$mdDialog,$q,BankService){function loadBankDetails(){BankService.get({customer:$dialogScope.customer}).then(function(res){$scope.bankList=res.data.results}),BankService.get({company:$dialogScope.company}).then(function(res){$scope.supplierbankList=res.data.results})}function saveReceiptDetails(data){$dialogScope.invoiceStatus?(data.invoice=$scope.invoice.id,delete data.invoice_state):data.po=$scope.order.id,data.document_date=dateService.convertDateToPython(data.document_date),InvoiceService.postPaymentReceipt(data).then(function(res){Notification.success({message:"Successfully saved",positionX:"right",positionY:"top"}),$mdDialog.cancel()})}InvoiceService.getInvoiceStates().then(function(res){$scope.statusList=res.data.results}),$scope.data={},$scope.showState=!1,$dialogScope.invoiceStatus?($scope.showState=!0,$scope.invoice=$dialogScope.invoice,$scope.data.invoice_state=$scope.invoice.invoice_state.id,$scope.data.value=$scope.invoice.total_price_with_tax):($scope.order=$dialogScope.order,$scope.data.value=$scope.order.price_number),InvoiceService.getPaymentTyes().then(function(res){$scope.paymentTypes=res.data.results}),$dialogScope&&$dialogScope.customer&&loadBankDetails(),CompanyService.getCurrencyType().then(function(data){$scope.currencyTypeList=data.data.results},function(err){console.log(err)}),$scope.AddBankDetails=function(ev,type){var companyId,customerId;"customer"==type&&(customerId=$dialogScope.customer,companyId=null),"supplier"==type&&(companyId=$dialogScope.company,customerId=null),$mdDialog.show({controller:"BankController",templateUrl:"assets/js/modules/customer/bank-details/bank-details.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1,multiple:!0,locals:{$dialogScope:{type:"Add",customerId:customerId,companyId:companyId}}}).then(function(res){res&&loadBankDetails()})},$scope.save=function(data){var obj={};return obj.invoice_state=data.invoice_state,data.document?data.document_date?void($dialogScope.invoiceStatus?InvoiceService.update($scope.invoice.id,obj).then(function(res){saveReceiptDetails(data)}):saveReceiptDetails(data)):void Notification.error({message:"please select document date",positionX:"right",positionY:"top"}):void Notification.error({message:"please enter document",positionX:"right",positionY:"top"})},$scope.cancel=function(){$mdDialog.cancel()}}])}();