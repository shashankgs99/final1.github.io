"use strict";!function(){var app=angular.module("app");app.controller("layout.standard.customerController",["$scope","$state","Notification","CustomerService","UserService","$timeout","$window",function($scope,$state,Notification,CustomerService,UserService,$timeout,$window){function loadCustomerData(data){CustomerService.get(data).then(function(data){$scope.count=data.data.count,$scope.customersList=data.data.results,$scope.customersList=$scope.customersList.map(function(item){return item.role_type&&item.role_type.map(function(data){$scope.userRoles.map(function(role){role.id==data&&(item.roleType=role.role_type_name)})}),item}),$scope.showLoader=!1})}$scope.showLoader=!0,loadCustomerData({page_size:10,page:1}),$scope.currentPage=1,$scope.maxSize=10,$scope.params={},$scope.selectedCustomer=[],$scope.setPage=function(pageNo){$scope.currentPage=pageNo,loadCustomerData({page_size:10,page:pageNo})},$scope.selectedValue=function(data,index,value){value?$scope.selectedCustomer.push(data):$scope.selectedCustomer.splice(index,1)},UserService.getRoleTypes().then(function(roleData){$scope.userRoles=roleData.data.results}),$scope.ownerId=$scope.current_user.data.id,$scope.tinymceOptions={resize:!1,width:1160,height:130,plugins:"print textcolor",toolbar:"undo redo styleselect bold italic print forecolor backcolor",setup:function(ed){ed.on("NodeChange",function(e){$scope.message=ed.getContent()})}},$scope.editCustomer=function(data){return data.length>1?void Notification.error({message:"please select one item",positionX:"right",positionY:"top"}):data.length<1?void Notification.error({message:"please select atleast one item",positionX:"right",positionY:"top"}):void($state.current.name.includes("adminDashboard")?$state.go("adminDashboard.customers.edit",{customerId:data[0].id}):$state.go("supplierDashboard.customers.edit",{customerId:data[0].id}))},$scope.cancelCustomer=function(){$state.current.name.includes("adminDashboard")?$state.go("adminDashboard.customers.list"):$state.go("supplierDashboard.customers.list")},$scope.addCustomer=function(){$state.current.name.includes("adminDashboard")?$state.go("adminDashboard.customers.create"):$state.go("supplierDashboard.customers.create")},$scope.viewCompany=function(data){return data.length>1?void Notification.error({message:"please select one item",positionX:"right",positionY:"top"}):data.length<1?void Notification.error({message:"please select atleast one item",positionX:"right",positionY:"top"}):void($state.current.name.includes("adminDashboard")?$state.go("adminDashboard.customers.viewCompany",{companyId:data[0].id}):$state.go("supplierDashboard.customers.viewCompany",{companyId:data[0].id}))},$scope.viewCompanyDetails=function(data){$state.current.name.includes("adminDashboard")?$state.go("adminDashboard.customers.viewCompany",{companyId:data.id}):$state.go("supplierDashboard.customers.viewCompany",{companyId:data.id})},$scope.viewProjects=function(data){if(data.length>1)return void Notification.error({message:"please select one item",positionX:"right",positionY:"top"});if(data.length<1)return void Notification.error({message:"please select atleast one item",positionX:"right",positionY:"top"});if(data){data[0].role_type;$state.current.name.includes("adminDashboard")?$state.go("adminDashboard.projects.list",{customer:data[0]}):$state.go("supplierDashboard.projects.list",{customer:data[0]})}},$scope.deleteCustomer=function(data){if(0===data.length)return void Notification.error({message:"Please select atleast one item to Delete",positionX:"right",positionY:"top"});var deletedRecords=[];data.map(function(item){CustomerService["delete"](item.id).then(function(res){deletedRecords.push(res.data),deletedRecords.length==data.length&&(Notification.success({message:"Successfully deleted",positionX:"right",positionY:"top"}),$scope.selectedCustomer=[],loadCustomerData({page_size:10,page:1}))})})},$scope.addMultiple=function(){$state.current.name.includes("adminDashboard")?$state.go("adminDashboard.customers.multipleCustomers"):$state.go("supplierDashboard.customers.multipleCustomers")},$scope.addContacts=function(){$state.current.name.includes("adminDashboard")?$state.go("adminDashboard.customers.addContacts"):$state.go("supplierDashboard.customers.addContacts")},$scope.viewContacts=function(data){return data.length>1?void Notification.error({message:"please select one item",positionX:"right",positionY:"top"}):data.length<1?void Notification.error({message:"please select atleast one item",positionX:"right",positionY:"top"}):void $state.go("supplierDashboard.customers.viewContacts",{data:data,companyId:data[0].id})},$scope.CustomersFilters=function(data){if(data.selectedItem&&($scope.params.owner=data.selectedItem.id),data.date_from){var date=new Date(data.date_from),dateString=new Date(date.getTime()-6e4*date.getTimezoneOffset()).toISOString().split("T")[0],result=dateString.replace(/['"]+/g,"");$scope.params.created_date__gte=result}if(data.date_to){var date=new Date(data.date_to),dateString=new Date(date.getTime()-6e4*date.getTimezoneOffset()).toISOString().split("T")[0],result=dateString.replace(/['"]+/g,"");$scope.params.created_date__lte=result}data.name&&($scope.params.name__icontains=data.name),$scope.params.page_size=10,$scope.params.page=1,loadCustomerData($scope.params)},$scope.clear=function(){$scope.filter={},$scope.params={},$scope.params.page_size=10,$scope.params.page=1,loadCustomerData($scope.params)}}])}();