"use strict";!function(){angular.module("app").controller("layout.order.IMINItemsController",["$scope","$dialogScope","$modal","$log","$state","Notification","$http","UserService","POService","dateService","$rootScope","$stateParams","$mdDialog","$q",function($scope,$dialogScope,$modal,$log,$state,Notification,$http,UserService,POService,dateService,$rootScope,$stateParams,$mdDialog,$q){function getRowId(row){return row.id}function loadGRNColumns(){$scope.iminGridOptions.columnDefs=[],$scope.iminGridOptions.columnDefs=[{name:"checked",displayName:"",cellTemplate:'<input type="checkbox" ng-model="row.entity.checked">',width:50},{name:"displayId",displayName:"#",width:75,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"po_item.title",displayName:"Title",width:150,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"po_item.description",displayName:"Description",width:200,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"po_item.selected_quantity",displayName:"Quantity",width:100,pinnedLeft:!0,enableSorting:!0,enableCellEdit:!1},{field:"quantity_received",displayName:"Received",width:100,pinnedLeft:!0,enableSorting:!0,enableCellEdit:!1},{field:"manufacturer",displayName:"Manufacturer",width:100,pinnedLeft:!0,enableSorting:!0,enableCellEdit:!1},{field:"po_item.unit_measure",displayName:"Unit Of Measure",width:100,pinnedLeft:!0,enableCellEdit:!1},{field:"batch",displayName:"Batch",width:100,pinnedLeft:!0,enableCellEdit:!0},{field:"serial",displayName:"Serial",width:100,pinnedLeft:!0,enableCellEdit:!0},{field:"production_date",displayName:"Production Date",width:125,pinnedLeft:!0,enableCellEdit:!0},{field:"expiry_date",displayName:"Expiry Date",width:100,pinnedLeft:!0,enableCellEdit:!0},{field:"delivery_date",displayName:"Delivery Date",width:125,pinnedLeft:!0,enableCellEdit:!0},{field:"yard_receipt_date",displayName:"Yard Receipt Date",width:125,pinnedLeft:!0,enableCellEdit:!0},{field:"imin_status.name",displayName:"Status",width:125,pinnedLeft:!0,enableCellEdit:!0},{field:"inspected_remarks",displayName:"Remarks",width:125,pinnedLeft:!0,enableCellEdit:!0}]}$scope.imin=$dialogScope.data,$scope.showsave=!1,$scope.disableSave=!1,$scope.showNext=!0,POService.getGRNItems({grnId:$dialogScope.data.id}).then(function(result){$scope.iminGridOptions.data=result.data.results,$scope.iminGridOptions.data=$scope.iminGridOptions.data.map(function(item){return item.checked=!1,item.displayId=item.po_item.item_number.split("-").pop().split("_").pop(),item})}),$scope.iminGridOptions={enableCellEditOnFocus:!0,enableColumnResizing:!0,enableFiltering:!0,enableGridMenu:!0,showGridFooter:!0,showColumnFooter:!0,fastWatch:!0,rowIdentity:getRowId,getRowIdentity:getRowId,importerDataAddCallback:function(grid,newObjects){$scope.myData=$scope.data.concat(newObjects)},onRegisterApi:function(registeredApi){$scope.gridApi=registeredApi}},loadGRNColumns(),$scope.cancel=function(){$mdDialog.cancel()},$scope.selectAll=function(value){value?$scope.iminGridOptions.data=$scope.iminGridOptions.data.map(function(item){return item.checked=!1,item}):$scope.iminGridOptions.data=$scope.iminGridOptions.data.map(function(item){return item.checked=!0,item})},$scope.next=function(){var data=[];$scope.iminGridOptions.data.map(function(item){item.checked&&data.push(item)}),$scope.iminGridOptions.data=data,$scope.showNext=!1,$scope.showsave=!0,loadGRNColumns()},$scope.removeItems=function(){var data=$scope.iminGridOptions.data,arr1=[],arr2=[];return data.map(function(item){item.checked?arr1.push(item):arr2.push(item)}),arr1.length?($scope.iminGridOptions.data=[],void($scope.iminGridOptions.data=arr2)):void Notification.error({message:"please select items to remove",positionX:"right",positionY:"top"})},$scope.saveItems=function(){var arr=[];$scope.disableSave=!0;var error=!1,data=$scope.iminGridOptions.data;data.map(function(item){return error?void($scope.disableSave=!1):item.imin_status?void 0:(Notification.error({message:"please select status",positionX:"right",positionY:"top"}),$scope.disableSave=!1,void(error=!0))}),error||data.map(function(record){record.is_verified=!0,record.imin_status=record.imin_status.id,Object.keys(record.grn).length?record.grn=record.grn.id:record.grn=record.grn,Object.keys(record.po_item).length?record.po_item=record.po_item.id:record.po_item=record.po_item,POService.updateGRNItem(record.id,record).then(function(res){arr.push(res.data),arr.length==data.length&&($scope.disableSave=!1,Notification.success({message:"successfully created",positionX:"right",positionY:"top"}),$mdDialog.hide())},function(){$scope.disableSave=!1})})},$scope.updateDetails=function(ev){var data=[];return $scope.iminGridOptions.data.map(function(item){item.checked&&data.push(item)}),data.length?$mdDialog.show({controller:"layout.order.updateGRNItems",templateUrl:"assets/js/modules/po/GRN/update-grn-details/update-grn-details.html",parent:angular.element(document.body),targetEvent:ev,multiple:!0,clickOutsideToClose:!0,locals:{$dialogScope:{display:"imin"}}}).then(function(res){$scope.iminGridOptions.data=$scope.iminGridOptions.data.map(function(item){return item.checked&&(res&&res.imin_status&&(item.imin_status=res.imin_status),res&&res.inspected_remarks&&(item.inspected_remarks=res.inspected_remarks)),item})}):void Notification.error({message:"please select items",positionX:"right",positionY:"top"})}}])}();