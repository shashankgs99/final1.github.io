"use strict";!function(){var app=angular.module("app");app.controller("layout.standard.viewPaymentRequestItems",["$scope","$window","$mdDialog","$log","$state","Notification","MessageService","$http","s3Service","dateService","OfferService","$rootScope","$timeout","$stateParams","MTOService","MTOOfferService","$dialogScope","POService","$filter","uiGridConstants",function($scope,$window,$mdDialog,$log,$state,Notification,MessageService,$http,s3Service,dateService,OfferService,$rootScope,$timeout,$stateParams,MTOService,MTOOfferService,$dialogScope,POService,$filter,uiGridConstants){function loadPaymentDetails(){$scope.prGridOptions.columnDefs=[],$scope.prGridOptions.columnDefs=[{name:"s_no",displayName:"#",width:75,type:"number",pinnedLeft:!0,enableCellEdit:!1},{field:"type",displayName:"Type",width:200,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"title",displayName:"Title",width:200,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"payment_date",displayName:"Date",width:125,pinnedLeft:!0,enableCellEdit:!1},{field:"value",displayName:"Value",width:150,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"currency",displayName:"Currency",width:200,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0}]}function loadPRColumns(){$scope.prGridOptions.columnDefs=[],$scope.prGridOptions.columnDefs=[{name:"displayId",displayName:"#",width:75,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"po_item.title",displayName:"Title",width:150,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"po_item.description",displayName:"Description",width:200,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"po_item.selected_quantity",displayName:"Quantity",width:100,pinnedLeft:!0,enableSorting:!0,enableCellEdit:!1},{field:"po_item.unit_measure",displayName:"Unit Of Measure",width:100,pinnedLeft:!0,enableCellEdit:!1},{field:"po_item.unit_price",displayName:"Item Value",width:80,pinnedLeft:!0,enableCellEdit:!1},{field:"invoiced_quantity",displayName:"Item Value(Invoiced)",width:150,pinnedLeft:!0,enableCellEdit:!1},{field:"invoice_value",displayName:"Invoice Value",width:200,aggregationType:uiGridConstants.aggregationTypes.sum,pinnedLeft:!0,enableCellEdit:!1},{field:"payment_status.name",displayName:"Payment Status",width:150,pinnedLeft:!0,enableCellEdit:!1},{field:"payment_due_date",displayName:"Payment Due Date",width:150,pinnedLeft:!0,enableCellEdit:!1}]}function loadSOColumns(){$scope.prGridOptions.columnDefs=[],$scope.prGridOptions.columnDefs=[{name:"displayId",displayName:"#",width:75,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"so_item.title",displayName:"Title",width:150,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"so_item.description",displayName:"Description",width:200,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0},{field:"quantity",displayName:"Quantity",width:100,pinnedLeft:!0,enableSorting:!0,enableCellEdit:!1},{field:"so_item.unit_measure",displayName:"Unit Of Measure",width:100,pinnedLeft:!0,enableCellEdit:!1},{field:"total_value",displayName:"Item Value",width:80,pinnedLeft:!0,enableCellEdit:!1},{field:"payment_status.name",displayName:"Payment Status",width:150,pinnedLeft:!0,enableCellEdit:!1},{field:"payment_date",displayName:"Payment Due Date",width:150,pinnedLeft:!0,enableCellEdit:!1}]}$scope.prGridOptions={data:$dialogScope.data,enableCellEditOnFocus:!0,enableColumnResizing:!0,enableFiltering:!0,enableGridMenu:!0,showGridFooter:!0,showColumnFooter:!0,fastWatch:!0,importerDataAddCallback:function(grid,newObjects){$scope.myData=$scope.data.concat(newObjects)},onRegisterApi:function(registeredApi){$scope.gridApi=registeredApi}},$scope.type=$dialogScope.type,"payment-request"==$dialogScope.type?$state.current.name.includes("buyerDashboard")?($scope.prGridOptions.data=$scope.prGridOptions.data.map(function(item){return item.displayId=item.po_item.item_number.split("-").pop().split("_").pop(),item}),loadPRColumns()):($scope.prGridOptions.data=$scope.prGridOptions.data.map(function(item){return item.total_value=item.quantity*item.so_item.unit_price,item.so_item.installment_item_details&&item.so_item.installment_item_details.length&&item.so_item.installment_item_details.map(function(ins){var installment=_.find($dialogScope.SOInstallments,{id:ins.installment}),expectedDate=dateService.convertDateToJS(installment.expected_milestone_date),result=expectedDate.addDays(installment.credit);item.payment_date=dateService.convertDateToPython(result)}),item.displayId=item.so_item.item_number.split("-").pop().split("_").pop(),item}),loadSOColumns()):loadPaymentDetails(),$scope.order=$dialogScope.order,$scope.cancel=function(){$mdDialog.cancel()}}])}();