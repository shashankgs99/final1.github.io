"use strict";!function(){var app=angular.module("app");app.controller("create.orders",["$scope","$q","$log","$state","$http","$mdDialog","ProjectService","MessageService","OfferService","BuyerSupplierService","PRGroupService","MTOService","dateService","POService","CompanyService","CustomerService","Notification","PurchaseRequisitionService","$stateParams","UserService",function($scope,$q,$log,$state,$http,$mdDialog,ProjectService,MessageService,OfferService,BuyerSupplierService,PRGroupService,MTOService,dateService,POService,CompanyService,CustomerService,Notification,PurchaseRequisitionService,$stateParams,UserService){function inWords(num){var str;if((num=num.toString()).length>9)return"overflow";var n=("000000000"+num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);if(n){var str="";return str+=0!=n[1]?(a[Number(n[1])]||b[n[1][0]]+" "+a[n[1][1]])+"crore ":"",str+=0!=n[2]?(a[Number(n[2])]||b[n[2][0]]+" "+a[n[2][1]])+"lakh ":"",str+=0!=n[3]?(a[Number(n[3])]||b[n[3][0]]+" "+a[n[3][1]])+"thousand ":"",str+=0!=n[4]?(a[Number(n[4])]||b[n[4][0]]+" "+a[n[4][1]])+"hundred ":"",str+=0!=n[5]?(""!=str?"and ":"")+(a[Number(n[5])]||b[n[5][0]]+" "+a[n[5][1]])+"only ":""}}function RenderOrderInfo(){$scope.order.supplier_name&&$scope.suppliers.map(function(supplier){supplier.name==$scope.order.supplier_name&&($scope.order.supplierName=supplier,$scope.supplierAddress.length||$scope.contacts(supplier),$scope.supplierInfo&&($scope.order.supplierContactName=$scope.supplierInfo))}),$scope.buyersContact.map(function(item){item.fullName===$scope.order.buyer_contact_name&&($scope.order.buyer_contact=item)}),$scope.order.delivery_date&&($scope.order.deliveryDate=dateService.convertDateToJS($scope.order.delivery_date)),$scope.order.po_date&&($scope.order.poDate=dateService.convertDateToJS($scope.order.po_date)),$scope.order.supplier_address&&$scope.supplierAddress.map(function(item){item.id==$scope.order.supplier_address&&($scope.order.supplier_address=item.id)})}function CalculateAmount(data){var totalPrice,obj={};POService.getPOItems({poId:$scope.order.id}).then(function(res){$scope.totalItemsCount=res.data.results.length;var totalItems=res.data.results;totalItems.length?totalItems.map(function(item){totalPrice=totalPrice?parseFloat(item.total_price)+parseFloat(totalPrice):item.total_price}):totalPrice=null,obj.price_number=totalPrice,obj.price_words=totalPrice?inWords(totalPrice):null,UpdatePOAmount(obj)})}function UpdatePOAmount(data){POService.update($scope.order.id,data).then(function(info){$scope.order=info.data,RenderOrderInfo(),Notification.success({message:"Successfully saved",positionX:"right",positionY:"top"})})}$stateParams.orderId||($scope.title="Purchase"),$stateParams.orderId||($scope.title="Purchase"),$scope.disableSave=!1,$scope.tabIndex=0,$scope.showView=!1,$scope.disabledType=!1,$scope.disabledSupplyType=!1,$scope.disabledPODate=!1,$scope.savedItems=[],$scope.disableCurrency=!1,$scope.list={},$scope.projectsList=[],$scope.projectNames=[],$scope.PRList=[],$scope.removeSupplier=!1,$scope.removeCurrency=!1,$scope.removeDate=!1,$scope.annexureData=[],$scope.EditItemsList=[],$scope.subProjectNames=[],$scope.selectedSubProject=[],$scope.order={},$scope.currency,$scope.enquiryNumbers=[],$scope.projectsList=[],$scope.POTypes=[],$scope.suppliers=[],$scope.POItemsList=[],$scope.installmentsData=[],$scope.deletedInstallmentsData=[],$scope.addPRList=[],$scope.disabledProject=!1,$scope.disabledSupplier=!1,$scope.disabledEnquiry=!1,$scope.removeProject=!1,$scope.removeEnquiry=!1,$scope.removeSupplierType=!1,$stateParams.orderId&&($scope.showLoader=!0,$scope.showView=!0),POService.getPOType().then(function(data){$scope.poTypes=data.data.results}),CompanyService.getCurrencyType().then(function(data){$scope.currencyTypeList=data.data.results},function(err){console.log(err)}),POService.getSupplyTypes().then(function(data){$scope.supplyTypes=data.data.results},function(err){console.log(err)}),ProjectService.getMainProjects().then(function(data){$scope.projectsInfo=data.data,$scope.projectsInfo.forEach(function(item){$scope.projectNames.push({id:item.id,label:item.name})}),$scope.projectNames=_.uniqBy($scope.projectNames,"id")}),MessageService.getEnquirySent().then(function(data){$scope.enquiryData=data.data.results,$scope.enquiryData.forEach(function(item){item.enquiry_number&&$scope.enquiryNumbers.push({id:item.id,label:item.enquiry_number})})}),BuyerSupplierService.get().then(function(data){$scope.suppliers=data.data.results,suppliersData.forEach(function(item){$scope.suppliers.push({id:item.id,label:item.name})})}),$scope.current_user&&$scope.current_user.data&&$scope.current_user.data.company&&($stateParams.orderId||($scope.order.buyer_company_name=$scope.current_user.data.company.company_name,$scope.order.buyer_company=$scope.current_user.data.company.id),UserService.get({company:$scope.current_user.data.company.id}).then(function(data){if(data.data.results.length){var totalUsers=data.data.results;$scope.buyersContact=[],$scope.buyerAddress=[],totalUsers.map(function(user){var name,companyInfo=user.company;user.first_name&&(name=user.first_name),user.last_name&&(name+=user.last_name),user&&(user.fullName=name),$scope.buyersContact.push(user),companyInfo.addresses.length&&companyInfo.addresses.map(function(data){var address;data.nameofaddress&&(address=data.nameofaddress),data.addressline1&&(address?address+=","+data.addressline1:address=data.addressline1),data.addressline2&&(address?address+=","+data.addressline2:address=data.addressline2),data.city&&(address?address+=","+data.city:address=data.city),data.state&&(address?address+=","+data.state:address=data.state),data.country&&(address?address+=","+data.country:address=data.country),$scope.buyerAddress.push({address:address,id:data.id}),$scope.order&&$scope.order.buyer_address&&($scope.order.buyer_address=$scope.order.buyer_address.id)})}),$scope.buyerAddress=_.uniqBy($scope.buyerAddress,"id")}})),$stateParams.orderId&&(POService.getOne($stateParams.orderId).then(function(data){if($scope.order=data.data,$scope.title="Edit",$scope.showLoader=!1,$scope.order){var order=angular.copy($scope.order);$scope.existingItemsAmount=order.price_number,$scope.orderId=data.data.id,$scope.disablelast=!0,$scope.order.currency&&($scope.disableCurrency=!0),$scope.order.po_type&&($scope.disabledType=!0),$scope.order.po_supply_type&&($scope.disabledSupplyType=!0),$scope.order.po_supply_type=$scope.order.po_supply_type.id,$scope.order.po_type=$scope.order.po_type.id,$scope.order.project&&($scope.order.project=$scope.order.project.id,$scope.FilterPRList($scope.order.project)),$scope.disabledProject=!0,$scope.order.enquiry&&($scope.disabledEnquiry=!1),$scope.disabledSupplier=!0,$scope.order.po_date&&($scope.order.poDate=dateService.convertDateToJS($scope.order.po_date),$scope.disabledPODate=!0),$scope.order.enquiry&&($scope.order.enquiry=$scope.order.enquiry.id),$scope.order.supplier_name&&$scope.suppliers.map(function(supplier){supplier.name==$scope.order.supplier_name&&($scope.order.supplierName=supplier,$scope.contacts(supplier))}),$scope.order.buyer_contact_name&&$scope.buyersContact.map(function(item){item.fullName===$scope.order.buyer_contact_name&&($scope.order.buyer_contact=item)}),$scope.order.authorized_by&&$scope.buyersContact.map(function(item){item.fullName===$scope.order.authorized_by&&($scope.order.authorizedBy=item)}),$scope.order.delivery_date&&($scope.order.deliveryDate=dateService.convertDateToJS($scope.order.delivery_date)),$scope.order.buyer_address&&($scope.order.buyer_address=$scope.order.buyer_address.id)}}),$q.all([POService.getPOItems({poId:$stateParams.orderId}),POService.getReferences({poId:$stateParams.orderId}),POService.getScopeOfWork({poId:$stateParams.orderId}),POService.getPriceBasis({poId:$stateParams.orderId}),POService.getPaymentTerms({poId:$stateParams.orderId}),POService.getLiquidatedDamages({poId:$stateParams.orderId}),POService.getDeliveryTerms({poId:$stateParams.orderId}),POService.getBankGuarantee({poId:$stateParams.orderId}),POService.getGeneralTNC({poId:$stateParams.orderId}),POService.getOtherTerms({poId:$stateParams.orderId}),POService.getContactPerson({poId:$stateParams.orderId})]).then(function(result){if(result[0].data.results.length&&result[0].data.results.length){var totalData=result[0].data.results;totalData.map(function(poItem){$scope.POItemsList.push(poItem.id)}),$scope.totalItemsCount=$scope.POItemsList.length,$scope.POItemsCount=result[0].data.count;var order=angular.copy($scope.order);$scope.existingItemsAmount=order.price_number}result[1].data.results.length&&($scope.refer=result[1].data.results[0]),result[2].data.results.length&&($scope.sow=result[2].data.results[0]),result[3].data.results.length&&($scope.price=result[3].data.results[0]),result[4].data.results.length&&($scope.payment=result[4].data.results[0],$scope.payment&&POService.getPaymentInstallments({poId:$scope.payment.id}).then(function(data){$scope.uploadedInstallments=data.data.results})),result[5].data.results.length&&($scope.liquid=result[5].data.results[0]),result[6].data.results.length&&($scope.delivery=result[6].data.results[0]),result[7].data.results.length&&($scope.bank=result[7].data.results[0]),result[8].data.results.length&&($scope.terms=result[8].data.results[0]),result[9].data.results.length&&($scope.other=result[9].data.results[0]),result[10].data.results.length&&($scope.contact=result[10].data.results[0])})),$scope.subProject=function(project,value){value||$scope.FilterPRList(project),$scope.subProjectNames=[],$scope.order.sub_project=null,ProjectService.getSubProjects(project).then(function(data){$scope.sub_projects=data.data,$scope.sub_projects&&$scope.sub_projects.forEach(function(item){$scope.subProjectNames.push({id:item.id,label:item.name})}),$scope.order&&value&&$stateParams.orderId&&$scope.subProjectNames.map(function(item){item.id==value&&($scope.order.sub_project=item.id,$scope.FilterPRList(item.id))})})};var a=["","one ","two ","three ","four ","five ","six ","seven ","eight ","nine ","ten ","eleven ","twelve ","thirteen ","fourteen ","fifteen ","sixteen ","seventeen ","eighteen ","nineteen "],b=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];$scope.getBuyerDetails=function(data){data.email&&($scope.order.buyer_contact_email=data.email),data.contact_no&&($scope.order.buyer_contact_mobile=data.contact_no)},$scope.contacts=function(supplier,value){$scope.order.supplier_company=supplier.id,$scope.suppliersContact=[],$scope.supplierAddress=[],BuyerSupplierService.getOne(supplier.id).then(function(data){var suppliersInfo=data.data;$scope.logo=suppliersInfo.logo,suppliersInfo.contacts.length&&(suppliersInfo.contacts.forEach(function(item){var name;item.firstname&&(name=item.firstname),item.lastname&&(name+=item.lastname),name&&(item.fullName=name),$scope.suppliersContact.push(item)}),$scope.order&&$scope.order.supplier_contact_name&&$scope.suppliersContact.map(function(contact){contact.fullName==$scope.order.supplier_contact_name&&($scope.order.supplierContactName=contact)})),suppliersInfo.addresses.length&&(suppliersInfo.addresses.map(function(data){var address;data.nameofaddress&&(address=data.nameofaddress),data.addressline1&&(address?address+=","+data.addressline1:address=data.addressline1),data.addressline2&&(address?address+=","+data.addressline2:address=data.addressline2),data.city&&(address?address+=","+data.city:address=data.city),data.state&&(address?address+=","+data.state:address=data.state),data.country&&(address?address+=","+data.country:address=data.country),$scope.supplierAddress.push({address:address,id:data.id})}),$scope.order&&$stateParams.orderId&&$scope.order.supplier_address&&($scope.order.supplier_address=$scope.order.supplier_address.id))})},$scope.supplierDetails=function(data){data.phonenumber1&&($scope.order.supplier_contact_mobile=data.phonenumber1),$scope.order.supplier_contact_mobile||data.phonenumber2&&($scope.order.supplier_contact_mobile=data.phonenumber2),data.emailid1&&($scope.order.supplier_contact_email=data.emailid1),$scope.order.supplier_contact_email||data.emailid2&&($scope.order.supplier_contact_email=data.emailid2)},$scope.saveOrder=function(order){return $scope.disableSave=!0,order.po_type?order.po_supply_type?order.authorizedBy?order.poDate?order.project?order.supplierName&&order.supplierContactName?order.supplier_contact_mobile?order.supplier_contact_email?order.supplier_address?order.buyer_contact?order.buyer_contact_mobile?order.buyer_contact_email?order.deliveryDate?(!$stateParams.orderId&&$scope.current_user.data&&$scope.current_user.data.company&&(order.buyer_company_name=$scope.current_user.data.company.company_name,order.buyer_company=$scope.current_user.data.company.id),order.authorizedBy&&(order.authorized_by=order.authorizedBy.fullName,order.authorized_by_user=order.authorizedBy.id),order.supplierName&&(order.supplier_name=order.supplierName.name),order.poDate&&(order.po_date=dateService.convertDateToPython(order.poDate)),order.deliveryDate&&(order.delivery_date=dateService.convertDateToPython(order.deliveryDate)),order.supplierContactName&&($scope.supplierInfo=order.supplierContactName,order.supplier_contact_name=order.supplierContactName.fullName),order.buyer_contact&&(order.buyer_contact_name=order.buyer_contact.fullName),order.supplier&&(order.supplier_name=order.supplier.label),order.sub_project||delete order.sub_project,order.po_status&&(order.po_status=order.po_status.id),void(order.id?(delete order.owner,order.enquiry||delete order.enquiry,POService.update(order.id,order).then(function(data){$scope.disableSave=!1,$scope.disabledOrder=!0,$scope.disabledType=!0,$scope.disableCurrency=!0,$scope.disabledSupplyType=!0,$scope.disabledPODate=!0,$scope.disabledProject=!0,$scope.order.enquiry&&($scope.disabledEnquiry=!0),$scope.disabledSupplier=!0,$scope.orderId=data.data.id,RenderOrderInfo(),Notification.success({message:"Successfully updated",positionX:"right",positionY:"top"}),$scope.tabIndex=1},function(err){$scope.disableSave=!1})):(order.po_status=1,POService.post(order).then(function(data){$scope.disableSave=!1,$scope.disabledOrder=!0,$scope.disabledType=!0,$scope.disableCurrency=!0,$scope.disabledSupplyType=!0,$scope.disabledPODate=!0,$scope.disabledProject=!0,$scope.order.enquiry&&($scope.disabledEnquiry=!0),$scope.disabledSupplier=!0,$scope.order=data.data,$scope.orderId=data.data.id,RenderOrderInfo(),Notification.success({message:"Successfully  created",positionX:"right",positionY:"top"}),$scope.tabIndex=1},function(err){$scope.disableSave=!1})))):(Notification.error({message:"please select delivery date",positionX:"right",positionY:"top"}),void($scope.disableSave=!1)):(Notification.error({message:"please select buyer email",positionX:"right",positionY:"top"}),void($scope.disableSave=!1)):(Notification.error({message:"please enter buyer mobile",positionX:"right",positionY:"top"}),void($scope.disableSave=!1)):(Notification.error({message:"please select buyer contact",positionX:"right",positionY:"top"}),void($scope.disableSave=!1)):(Notification.error({message:"please select supplier address",positionX:"right",positionY:"top"}),void($scope.disableSave=!1)):(Notification.error({message:"please select supplier emailId",positionX:"right",positionY:"top"}),void($scope.disableSave=!1)):(Notification.error({message:"please enter supplier mobile",positionX:"right",positionY:"top"}),void($scope.disableSave=!1)):(Notification.error({message:"please select supplier",positionX:"right",positionY:"top"}),void($scope.disableSave=!1)):(Notification.error({message:"please select project",positionX:"right",positionY:"top"}),void($scope.disableSave=!1)):(Notification.error({message:"please select date",positionX:"right",positionY:"top"}),void($scope.disableSave=!1)):(Notification.error({message:"please enter authorized by",positionX:"right",positionY:"top"}),void($scope.disableSave=!1)):(Notification.error({message:"please select supply Type",positionX:"right",positionY:"top"}),void($scope.disableSave=!1)):(Notification.error({message:"please select PO Type",positionX:"right",positionY:"top"}),void($scope.disableSave=!1))},$scope.FilterPRList=function(data){PRGroupService.get({project:data}).then(function(data){$scope.PRList=data.data.results,$scope.PRDataList=angular.copy($scope.PRList)})},$scope.viewPR=function(ev,data,ind){var result=[],groupInfo=data;data&&PurchaseRequisitionService.get({groupId:data.id}).then(function(data){var items=data.data.results;return items.length?(items.map(function(pr){pr.quantity_remaining=parseInt(pr.total_quantity)-parseInt(pr.quantity_ordered),pr.selected_quantity=0,$scope.order&&$scope.order.delivery_date&&(pr.delivery_date=$scope.order.delivery_date),pr.checked=!1,pr.quantity_remaining>0&&result.push(pr)}),result=_.sortBy(result,"item_number"),$mdDialog.show({controller:"layout.standard.viewPRData",templateUrl:"assets/partials/dashboard/admin/purchase-requisition/view-PR/view-PR.html",parent:angular.element(document.body),targetEvent:ev,multiple:!0,clickOutsideToClose:!0,locals:{$dialogScope:{showButtons:!0,items:result,type:"add",orderId:$scope.order.id,group:groupInfo,"delete":!1}}}).then(function(resp){resp&&($scope.order=resp.order,$scope.savedItems.push(resp),$scope.totalItemsCount=resp.count)},function(err){})):void Notification.error({message:"Selected PR has no items",positionX:"right",positionY:"top"})})},$scope.ViewExisitingPR=function(ev,data,$index,totalInfo){return data=data.map(function(item){return item.quantity_remaining=item.available_quantity,item.state=!1,item.checked=!1,item}),$mdDialog.show({controller:"layout.standard.viewPRData",templateUrl:"assets/partials/dashboard/admin/purchase-requisition/view-PR/view-PR.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,locals:{$dialogScope:{type:"edit",items:data,orderId:$scope.order.id,"delete":!0}}}).then(function(resp){resp&&($scope.order=resp.order,$scope.POItemsList=resp.savedItems,$scope.POItemsCount=resp.savedItems.length,$scope.existingItemsAmount=$scope.order.price_number,$scope.totalItemsCount=resp.count)},function(err){})},$scope.ViewPOItems=function(ev,data,$index,totalInfo,type){var items=[];data.length&&data.map(function(item){POService.getOneItem(item).then(function(res){items.push(res.data),data.length==items.length&&("edit"==$index?$scope.ViewExisitingPR(ev,items,$index,totalInfo):$scope.ViewExisitingPO(ev,items,$index,totalInfo))})})},$scope.ViewExisitingPO=function(ev,data,$index,totalInfo){return data=data.map(function(item){return item.quantity_remaining=item.available_quantity,item.checked=!1,item.state=!1,item}),$mdDialog.show({controller:"layout.standard.viewPRData",templateUrl:"assets/partials/dashboard/admin/purchase-requisition/view-PR/view-PR.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,locals:{$dialogScope:{type:"edit",items:data,orderId:$scope.order.id,group:totalInfo.group,"delete":!0}}}).then(function(resp){if(resp){$scope.order=resp.order;var itemsData=$scope.savedItems[$index];itemsData.savedItems=resp.savedItems,resp.savedItems.length||$scope.savedItems.splice($index,1),$scope.totalItemsCount=resp.count}},function(err){})},$scope.installmentTerms=function(ev){var data;$scope.uploadedInstallments&&(data=$scope.uploadedInstallments),$scope.installmentsData.length&&(data=$scope.installmentsData),$mdDialog.show({controller:"annexure.one",templateUrl:"assets/js/modules/po/orders/create-orders/installmentterms.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,locals:{$dialogScope:{total:$scope.totalValue?$scope.totalValue:$scope.order.price_number,uploadedInfo:data}}}).then(function(data){data&&data.map(function(item){item.deleted?$scope.deletedInstallmentsData=item.deleted:$scope.installmentsData.push(item)})})},$scope.cancel=function(){$scope.payment.description={}},$scope.cancelOrder=function(){$state.go("buyerDashboard.order.list")},$scope.saveReferences=function(data){return data?($scope.disableReferences=!0,data.heading="References",void(data.id?POService.updateReferences(data.id,data).then(function(data){$scope.disableReferences=!1,$scope.refer=data.data,Notification.success({message:"successfully updated",positionX:"right",positionY:"top"})},function(err){$scope.disableReferences=!1}):(data.po=$scope.orderId,POService.postReferences(data).then(function(data){$scope.disableReferences=!1,$scope.refer=data.data,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"})},function(err){$scope.disableReferences=!1})))):void Notification.error({message:"please enter description",positionX:"right",positionY:"top"})},$scope.cancelReferences=function(){$scope.refer.description=void 0},$scope.saveSOW=function(data){return data?($scope.disableSOW=!0,data.heading="Scope Of Work",void(data.id?POService.updateScopeOfWork(data.id,data).then(function(data){$scope.disableSOW=!1,$scope.sow=data.data,Notification.success({message:"successfully updated",positionX:"right",positionY:"top"})},function(err){$scope.disableSOW=!1}):(data.po=$scope.orderId,POService.postScopeOfWork(data).then(function(data){$scope.disableSOW=!1,$scope.sow=data.data,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"})},function(err){$scope.disableSOW=!1})))):void Notification.error({message:"please enter description",positionX:"right",positionY:"top"})},$scope.cancelSOW=function(){$scope.sow.description=void 0},$scope.SavePriceBasis=function(data){return data?($scope.disablePriceBasis=!0,data.heading="Price & Price Basis",void(data.id?POService.updatePriceBasis(data.id,data).then(function(data){$scope.disablePriceBasis=!1,$scope.price=data.data,Notification.success({message:"successfully updated",positionX:"right",positionY:"top"})},function(err){$scope.disablePriceBasis=!1}):(data.po=$scope.orderId,POService.postPriceBasis(data).then(function(data){$scope.disablePriceBasis=!1,$scope.price=data.data,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"})},function(err){$scope.disablePriceBasis=!1})))):void Notification.error({message:"please enter description",positionX:"right",positionY:"top"})},$scope.cancePriceBasis=function(){$scope.price.description=void 0},$scope.SaveLiquidatedDamages=function(data){return data?(data.heading="Liquidated Damages",$scope.disableDamages=!0,void(data.id?POService.updateLiquidatedDamages(data.id,data).then(function(data){$scope.disableDamages=!1,$scope.liquid=data.data,Notification.success({message:"successfully updated",positionX:"right",positionY:"top"})},function(err){$scope.disableDamages=!1}):(data.po=$scope.orderId,POService.postLiquidatedDamages(data).then(function(data){$scope.disableDamages=!1,$scope.liquid=data.data,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"})},function(err){$scope.disableDamages=!1})))):void Notification.error({message:"please enter description",positionX:"right",positionY:"top"})},$scope.CancelLiquidatedDamages=function(){$scope.liquid.description=void 0},$scope.SaveDelivery=function(data){return data?(data.heading="Delivery Terms",$scope.disableDelivery=!0,void(data.id?POService.updateDeliveryTerms(data.id,data).then(function(data){$scope.delivery=data.data,$scope.disableDelivery=!1,Notification.success({message:"successfully updated",positionX:"right",positionY:"top"})},function(err){$scope.disableDelivery=!1}):(data.po=$scope.orderId,POService.postDeliveryTerms(data).then(function(data){$scope.delivery=data.data,$scope.disableDelivery=!1,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"})},function(err){$scope.disableDelivery=!1})))):void Notification.error({message:"please enter description",positionX:"right",positionY:"top"})},$scope.CancelDelivery=function(){$scope.delivery.description=void 0},$scope.SaveBank=function(data){return data?(data.heading="Bank Guarantees",$scope.disableBank=!0,void(data.id?POService.updateBankGuarantee(data.id,data).then(function(data){$scope.disableBank=!1,$scope.bank=data.data,Notification.success({message:"successfully updated",positionX:"right",positionY:"top"})},function(err){$scope.disableBank=!1}):(data.po=$scope.orderId,POService.postBankGuarantee(data).then(function(data){$scope.disableBank=!1,$scope.bank=data.data,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"})},function(err){$scope.disableBank=!1})))):void Notification.error({message:"please enter description",positionX:"right",positionY:"top"})},$scope.CancelBank=function(){$scope.bank.description=void 0},$scope.SaveTerms=function(data){return data?($scope.disableTerms=!0,data.heading="General Terms & Conditions",void(data.id?POService.updateGeneralTNC(data.id,data).then(function(data){$scope.disableTerms=!1,$scope.terms=data.data,Notification.success({message:"successfully updated",positionX:"right",positionY:"top"})},function(err){$scope.disableTerms=!1}):(data.po=$scope.orderId,POService.postGeneralTNC(data).then(function(data){$scope.disableTerms=!1,$scope.terms=data.data,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"})},function(err){$scope.disableTerms=!1})))):void Notification.error({message:"please enter description",positionX:"right",positionY:"top"})},$scope.CancelTerms=function(){$scope.terms.description=void 0},$scope.SaveOtherTerms=function(data){return data?($scope.disableOther=!0,data.heading="Other Terms",void(data.id?POService.updateOtherTerms(data.id,data).then(function(data){$scope.other=data.data,$scope.disableOther=!1,Notification.success({message:"successfully updated",positionX:"right",positionY:"top"})},function(err){$scope.disableOther=!1}):(data.po=$scope.orderId,POService.postOtherTerms(data).then(function(data){$scope.other=data.data,$scope.disableOther=!1,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"})},function(err){$scope.disableOther=!1})))):void Notification.error({message:"please enter description",positionX:"right",positionY:"top"})},$scope.CancelOtherTerms=function(){$scope.other.description=void 0},$scope.SaveContact=function(data){return data?(data.heading="Contact Person",$scope.disableContacts=!0,void(data.id?POService.updateContactPerson(data.id,data).then(function(data){$scope.contact=data.data,$scope.disableContacts=!1,Notification.success({message:"successfully updated",positionX:"right",positionY:"top"})},function(err){$scope.disableContacts=!1}):(data.po=$scope.orderId,POService.postContactPerson(data).then(function(data){$scope.contact=data.data,$scope.disableContacts=!1,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"})},function(err){$scope.disableContacts=!1})))):void Notification.error({message:"please enter description",positionX:"right",positionY:"top"})},$scope.CancelContact=function(){$scope.contact.description=void 0},$scope.SavePayments=function(data){var info=[];data||(data={}),data.heading="Payment Terms",$scope.deletedInstallmentsData&&$scope.deletedInstallmentsData.length&&$scope.deletedInstallmentsData.map(function(item){POService.deletePaymentInstallments(item.id).then(function(data){console.log("successfully deleted")})}),$scope.disablePayments=!0,data.id?POService.updatePaymentTerms(data.id,data).then(function(data){$scope.payment=data.data;var id=data.data.id;$scope.installmentsData.length?($scope.installmentsData=$scope.installmentsData.map(function(item){return item.payment_terms=id,item}),$scope.installmentsData.map(function(item){item.id?POService.updatePaymentInstallments(item.id,item).then(function(res){info.push(res.data),info.length==$scope.installmentsData.length&&($scope.installmentsData=[],$scope.uploadedInstallments=info,$scope.disablePayments=!1,Notification.success({message:"successfully updated",positionX:"right",positionY:"top"}))},function(err){$scope.disablePayments=!1}):POService.postPaymentInstallments(item).then(function(resp){info.push(resp.data),info.length==$scope.installmentsData.length&&($scope.installmentsData=[],$scope.uploadedInstallments=info,$scope.disablePayments=!1,Notification.success({message:"successfully updated",positionX:"right",positionY:"top"}))},function(err){$scope.disablePayments=!1})})):($scope.disablePayments=!1,Notification.success({message:"successfully updated",positionX:"right",positionY:"top"}))}):(data.po=$scope.orderId,POService.postPaymentTerms(data).then(function(data){$scope.payment=data.data;var id=data.data.id;$scope.installmentsData.length?($scope.installmentsData=$scope.installmentsData.map(function(item){return item.payment_terms=id,item}),POService.postPaymentInstallments($scope.installmentsData).then(function(resp){$scope.disablePayments=!1,$scope.uploadedInstallments=resp.data,$scope.installmentsData=[],Notification.success({message:"successfully saved",positionX:"right",positionY:"top"})},function(err){$scope.disablePayments=!1})):($scope.disablePayments=!1,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"}))}))},$scope.edit=function(){$scope.title="Edit",$scope.disabledOrder=!1},$scope.deletePR=function(data,$index){var arr=[];data.map(function(item){POService.deletePOItems(item).then(function(res){arr.push(res.data),data.length==arr.length&&($scope.savedItems.splice($index,1),CalculateAmount())})})},$scope.MoveAnnexure2=function(){$scope.disablelast=!0,$scope.tabIndex=2},$scope.enableData=function(type){"supplyType"===type&&($scope.disabledSupplyType=!$scope.disabledSupplyType,$scope.removeSupplierType=!$scope.removeSupplier),"date"===type&&($scope.disabledPODate=!$scope.disabledPODate,$scope.removeDate=!$scope.removeDate),"currency"==type&&($scope.disableCurrency=!$scope.disableCurrency,$scope.removeCurrency=!$scope.removeCurrency),"project"==type&&($scope.disabledProject=!$scope.disabledProject,$scope.removeProject=!$scope.removeProject),"enquiry"==type&&($scope.disabledEnquiry=!$scope.disabledEnquiry,$scope.removeEnquiry=!$scope.removeEnquiry),"supplier"===type&&($scope.disabledSupplier=!$scope.disabledSupplier,$scope.removeSupplier=!$scope.removeSupplier)},$scope.viewPO=function(){$state.go("buyerDashboard.order.view",{orderId:$scope.order.id})}}])}();