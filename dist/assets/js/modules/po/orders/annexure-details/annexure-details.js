"use strict";!function(){var app=angular.module("app");app.controller("layout.standard.annexureDetails",["$scope","$window","$mdDialog","$log","$state","Notification","PurchaseRequisitionService","$http","s3Service","dateService","OfferService","$rootScope","$timeout","$stateParams","MTOService","MTOOfferService","CompanyService","$filter","$dialogScope","TaxService",function($scope,$window,$mdDialog,$log,$state,Notification,PurchaseRequisitionService,$http,s3Service,dateService,OfferService,$rootScope,$timeout,$stateParams,MTOService,MTOOfferService,CompanyService,$filter,$dialogScope,TaxService){$scope.tax={taxList:[]},PurchaseRequisitionService.getUnits().then(function(res){$scope.unitsList=res.data.results,$scope.unitsList=_.sortBy($scope.unitsList,"id")}),$scope.type=$dialogScope.type,$scope.taxTypeList=[{id:1,name:"VAT"},{id:2,name:"Other Charges"}],$scope.checkTaxValue=function(data){if("CGST"==data.property&&0==data.sgst){if(data.sgst<=0)return Notification.error({message:"please enter valid value",positionX:"right",positionY:"top"}),void(data.sgst=void 0)}else if(data.value<=0)return Notification.error({message:"please enter valid value",positionX:"right",positionY:"top"}),void(data.value=void 0)},$scope.save=function(info){if("tax"==$dialogScope.type){var obj={},data=info.taxList;data.map(function(item){item&&item.taxType&&("GST"==item.taxType.name&&(item.value&&(obj.cgst=item.value),item.sgst&&(obj.sgst=item.sgst)),"VAT"==item.taxType.name&&item.value&&(obj.vat=item.value),"Other Charges"==item.taxType.name&&item.value&&(obj.other_charges=item.value))}),"secondary-units"==$dialogScope.type&&(info.secondary_units&&(obj.secondary_units=info.secondary_units),info.conversion_rate&&(obj.conversion_rate=info.conversion_rate)),$mdDialog.hide(obj)}else $mdDialog.hide(info)},$scope.cancel=function(){$mdDialog.cancel()},"tax"==$scope.type&&($scope.tax.taxList.length||$scope.tax.taxList.push({add:!0})),$scope.addTax=function(){$scope.tax.taxList.push({remove:!0})},$scope.removetax=function(index){$scope.tax.taxList.splice(index,1)},$scope.checkTaxType=function(data,index){var result=angular.copy($scope.tax.taxList),info=$scope.tax.taxList[index];"GST"==info.taxType.name?info.property="CGST":info.property=data.name,result.splice(index,1),result.length>=1&&result.map(function(item){item.taxType&&item.taxType.name==data.name&&(Notification.error({message:"tax type is already exisited in tax details",positionX:"right",positionY:"top"}),info.taxType=null,info.property=null,info.value=null)}),data&&"VAT"==data.name&&$scope.tax.taxList.map(function(res){res&&res.taxType&&"GST"==res.taxType.name&&(Notification.error({message:"please enter GST or VAT,not both",positionX:"right",positionY:"top"}),info.taxType=null,info.property=null,info.value=null)}),data&&"GST"==data.name&&$scope.tax.taxList.map(function(res){res&&res.taxType&&"VAT"==res.taxType.name&&(Notification.error({message:"please enter GST or VAT,not both",positionX:"right",positionY:"top"}),info.taxType=null,info.property=null,info.value=null)})}}])}();