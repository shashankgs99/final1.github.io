"use strict";!function(){var app=angular.module("app");app.controller("annexure.one",["$scope","$window","$log","$state","$http","$mdDialog","$dialogScope","Notification","dateService",function($scope,$log,$window,$state,$http,$mdDialog,$dialogScope,Notification,dateService){$scope.cancel=function(){$scope.installmentData.entered=!0,$mdDialog.hide($scope.installmentData)},$scope.installmentData=[],$scope.installmentTable=!1;var deletedData=[];$dialogScope.uploadedInfo&&$dialogScope.uploadedInfo.length&&($scope.installments=$dialogScope.uploadedInfo.length,$scope.installmentData=$dialogScope.uploadedInfo,$scope.installmentData=$scope.installmentData.map(function(item,$index){return item.expected_milestone_date&&item.id&&(item.expected_milestone_date=dateService.convertDateToJS(item.expected_milestone_date)),item.sno=$index+1,item}),$scope.installmentTable=!0),$scope.increaseRows=function(noOfRows){if(!noOfRows||noOfRows<=0)return void Notification.error({message:"please enter number of installments",positionX:"right",positionY:"top"});if($dialogScope.uploadedInfo&&$dialogScope.uploadedInfo.length)if(parseInt($scope.installments)>parseInt($scope.installmentData.length))for(var total=noOfRows-$scope.installmentData.length,number=$scope.installmentData.length+1,i=0;i<total;i++)$scope.installmentData.push({sno:number}),number++;else for(var total=$scope.installmentData.length-noOfRows,number=$scope.installmentData.length-1,i=0;i<total;i++){var info=$scope.installmentData[number];deletedData.push(info),$scope.installmentData.splice(number,1),number--}else{$scope.installmentTable=!0,$scope.installmentData=[];for(var i=0;i<noOfRows;i++)$scope.installmentData.push({sno:i+1})}},$scope.saveInstallments=function(data){$scope.installmentInfo=[];var formData=data,totalPercentage=0;if(formData.length&&formData.map(function(item){totalPercentage+=parseInt(item.percentage+"%")}),100!==totalPercentage)return void Notification.error({message:"Total percentage should be 100%",positionX:"right",positionY:"top"});var error=!1;data.map(function(item){if(!error)return item.credit?item.type?void 0:(Notification.error({message:"please select type",positionX:"right",positionY:"top"}),void(error=!0)):(Notification.error({message:"please enter credit",positionX:"right",positionY:"top"}),void(error=!0))}),formData.length&&!error&&(formData=formData.filter(function(record){return void 0!==record.percentage&&null!==record.percentage}),formData=formData.map(function(item,$index){item.expected_milestone_date&&(item.expected_milestone_date=dateService.convertDateToPython(item.expected_milestone_date));var value=$dialogScope.total/100*parseInt(item.percentage);return item.value=value,item.installment_number=$index+1,item}),deletedData.length&&formData.push({deleted:deletedData}),$mdDialog.hide(formData))}}])}();