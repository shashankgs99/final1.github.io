"use strict";!function(){var app=angular.module("app");app.controller("Stores.ListController",["$scope","$q","$log","$state","$http","$mdDialog","CityService","Notification","$stateParams","StoreService","POService",function($scope,$q,$log,$state,$http,$mdDialog,CityService,Notification,$stateParams,StoreService,POService){function LoadStoresList(data){StoreService.get(data).then(function(res){$scope.count=res.data.count,$scope.storesData=res.data.results,$scope.showLoader=!1})}$scope.currentPage=1,$scope.maxSize=10,$scope.filter={},$scope.selectedStores=[],$scope.totalCountries=[],$scope.totalStates=[],$scope.showLoader=!0,$scope.totalCities=[],LoadStoresList({page_size:10,page:1}),$scope.AddStore=function(){$state.go("storeDashboard.stores.create")},StoreService.getStoreTypes().then(function(res){$scope.storeTypes=res.data.results}),$scope.storeTypesList=[{id:1,name:"Inward Store"},{id:2,name:"Production"},{id:6,name:"Store(Others)"}],CityService.get().then(function(data){$scope.Locations=data.data.results,$scope.Locations.forEach(function(item){item.country&&$scope.totalCountries.push(item.country)}),$scope.totalCountries=_.uniq($scope.totalCountries)},function(error){console.log(error)}),$scope.toHelp=function(){$state.go("layout.standard.help.stroes",{type:"stores"})},$scope.selectStates=function(data){if(data.length){$scope.totalStates=[];if(data.forEach(function(country){$scope.Locations.forEach(function(item){country==item.country&&$scope.totalStates.push(item.state)})}),$scope.totalStates=_.uniq($scope.totalStates),$scope.filter.state){var selected=[];$scope.totalStates.map(function(item){$scope.filter.state.map(function(info){item==info&&selected.push(info)})}),$scope.filter.state=_.uniq(selected)}$scope.filter.cities&&$scope.selectCities($scope.filter.state)}else $scope.totalStates=[],$scope.totalCities=[]},$scope.selectCities=function(data){if(data.length){$scope.totalCities=[];var currentCountry=[];data.forEach(function(state){$scope.Locations.forEach(function(item){state==item.state&&currentCountry.push({id:item.id,country:item.country,state:state})})}),currentCountry=_.uniqBy(currentCountry,"id");var finalData=[];if(currentCountry.length&&currentCountry.map(function(item){$scope.filter.country.map(function(country){country===item.country&&$scope.filter.state.map(function(state){state===item.state&&finalData.push(item)})})}),finalData.map(function(info){$scope.Locations.forEach(function(item){info.state==item.state&&info.country==item.country&&$scope.totalCities.push(item.city)})}),$scope.totalCities=_.uniq($scope.totalCities),$scope.filter.cities){var selected=[];$scope.totalCities.map(function(item){$scope.filter.cities.map(function(info){item==info&&selected.push(info)})}),$scope.filter.cities=_.uniq(selected)}}else $scope.totalCities=[]},$scope.EditStore=function(data){return data.length>1?void Notification.error({message:"please select one item",positionX:"right",positionY:"top"}):data.length<1?void Notification.error({message:"please select atleast one item",positionX:"right",positionY:"top"}):void(data&&$state.go("storeDashboard.stores.edit",{storeId:data[0].id}))},$scope.setPage=function(pageNo){$scope.currentPage=pageNo,LoadStoresList({page_size:10,page:pageNo})},StoreService.get().then(function(res){$scope.storesDataList=res.data.results}),$scope.selectedValue=function(data,index,value){value?$scope.selectedStores.push(data):$scope.selectedStores.map(function(item,index){item.id===data.id&&($scope.selectedStores.splice(index,1),$scope.selectedStores.length-1)})},$scope.ViewStoreDetails=function(data){data&&$state.go("storeDashboard.stores.view",{storeId:data.id})},$scope.DeleteStore=function(data){var list=[];$scope.selectedStores.length?$scope.selectedStores.map(function(item){StoreService["delete"](item.id).then(function(res){list.push(res.data),list.length==$scope.selectedStores.length&&(Notification.success({message:"successfully deleted",positionX:"right",positionY:"top"}),$scope.selectedStores=[],LoadStoresList({page_size:10,page:1}))})}):Notification.error({message:"successfully deleted",positionX:"right",positionY:"top"})},$scope.applyFilters=function(data){data.page=1;var list;data.page_size=10,data.storeType&&($scope.storeTypes.map(function(item){item.name==data.storeType.name&&(data.store_type=item)}),data.store_type=data.store_type.id),data.country&&(data.location__country=data.country,list=data.state&&!data.cityname?_.map($scope.storesDataList,function(o){if(o.location.country==data.country&&o.location.state==data.state)return o}):data.state&&data.cityname?_.map($scope.storesDataList,function(o){if(o.location.country==data.country&&o.location.state==data.state&&o.location.cityname==data.cityname)return o}):_.map($scope.storesDataList,function(o){if(o.location.country==data.country)return o}),$scope.storesData=_.without(list,void 0),$scope.count=$scope.storesData.length),data.store_type&&LoadStoresList(data)},$scope.findStates=function(data){$scope.totalStates=[],$scope.Locations.forEach(function(item){item.country===data&&$scope.totalStates.push({id:item.id,country:item.country,state:item.state,city:item.city})}),$scope.totalStates=_.uniqBy($scope.totalStates,"state")},$scope.findCities=function(data){$scope.totalCities=[],$scope.Locations.map(function(item){data.country==item.country&&data.state==item.state&&$scope.totalCities.push(item.city)}),$scope.totalCities=_.uniq($scope.totalCities)},$scope.clear=function(){$scope.totalStates=[],$scope.totalCities=[],$scope.filter={},LoadStoresList({page_size:10,page:1})}}])}();