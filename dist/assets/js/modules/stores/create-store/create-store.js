"use strict";!function(){var app=angular.module("app");app.controller("Stores.CreateController",["$scope","$q","$log","$state","StoreService","$mdDialog","dateService","Notification","$stateParams","CompanyService","BuyerSupplierService","CustomerService","$injector",function($scope,$q,$log,$state,StoreService,$mdDialog,dateService,Notification,$stateParams,CompanyService,BuyerSupplierService,CustomerService,$injector){function LoadStoreData(){$scope.addresses=[],$scope.contactPersons=[],StoreService.getOne(Number($stateParams.storeId)).then(function(res){$scope.showLoader=!1,$scope.disabled=!0,$scope.store=res.data,$scope.storeTypesList.length&&$scope.storeTypesList.map(function(item){item.id==$scope.store.store_type.id&&($scope.store.store_type=item)}),$scope.disabledcustomer=!0;var address=$scope.store.location,addressDetails=address.nameofaddress+","+address.addressline1+","+address.addressline2+","+address.city+","+address.state+","+address.country;$scope.addresses.push({id:address.id,address:addressDetails});var contact=$scope.store.contact_person,contactName=contact.firstname+" "+contact.lastname;$scope.contactPersons.push({id:contact.id,name:contactName}),$scope.store.location=$scope.store.location.id,$scope.store.contact_person=$scope.store.contact_person.id})}function FilterContacts(data){$scope.contactPersons=[],data.map(function(item){var name=null;item.firstname&&(name=item.firstname),item.lastname&&(name=name?name+" "+item.lastname:item.lastname),name&&$scope.contactPersons.push({id:item.id,name:name})})}function FilterAddresses(data){$scope.addresses=[],data.map(function(res){var address;res.nameofaddress&&(address=res.nameofaddress),res.addressline1&&(address=address?address+","+res.addressline1:res.addressline1),res.addressline2&&(address=address?address+","+res.addressline2:res.addressline2),res.city&&(address=address?address+","+res.city:res.city),res.state&&(address=address?address+","+res.state:res.state),res.country&&(address=address?address+","+res.country:res.country),$scope.addresses.push({id:res.id,address:address})})}$scope.contactsList=[],$scope.suppliers=[],$scope.customers=[],$scope.disabled=!1,$scope.store={},$scope.disabledcustomer=!1,$scope.storeTypes=[],StoreService.getStoreTypes().then(function(res){$scope.storeTypes=res.data.results}),$scope.storeTypesList=[{id:1,name:"Inward Store"},{id:2,name:"Production"},{id:6,name:"Store(Others)"}],$stateParams.storeId&&($scope.showLoader=!0,LoadStoreData()),$q.all([BuyerSupplierService.get(),CustomerService.get()]).then(function(res){res[0].data.results&&($scope.suppliers=res[0].data.results),res[1].data.results&&($scope.customers=res[1].data.results)}),$scope.FilterData=function(item){if($scope.contactPersons=[],$scope.addresses=[],$scope.disabled=!1,$scope.current_user.data&&$scope.current_user.data.company){var data=$scope.current_user.data.company;data.contact.length&&FilterContacts(data.contact),data.addresses.length&&FilterAddresses(data.addresses)}},$scope.SelectContactsData=function(data){$scope.disabled=!1,data.contacts.length&&FilterContacts(data.contacts),data.addresses.length&&FilterAddresses(data.addresses)},$scope.SaveStore=function(data){if(!data.store_type)return void Notification.error({message:"please select store type",positionX:"right",positionY:"top"});if(!data.store_name)return void Notification.error({message:"please enter store name",positionX:"right",positionY:"top"});if(!data.contact_person)return void Notification.error({message:"please select contact person",positionX:"right",positionY:"top"});if(!data.location)return void Notification.error({message:"please select address",positionX:"right",positionY:"top"});var item=angular.copy(data);item.company?item.company=item.company.id:item.company=$scope.current_user.data.company.id,$scope.storeTypes.map(function(type){type.name==item.store_type.name&&(item.store_type=type)}),item.store_type=item.store_type.id,item.id?(delete item.owner,StoreService.update(item.id,item).then(function(res){Notification.success({message:"successfully updated",positionX:"right",positionY:"top"}),$state.go("storeDashboard.stores.list")})):StoreService.post(item).then(function(res){Notification.success({message:"successfully saved",positionX:"right",positionY:"top"}),$state.go("storeDashboard.stores.list")})},$scope.cancelStore=function(){$state.go("storeDashboard.stores.list")}}])}();