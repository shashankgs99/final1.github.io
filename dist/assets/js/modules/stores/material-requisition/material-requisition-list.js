"use strict";!function(){var app=angular.module("app");app.controller("layout.standard.MRListController",["$scope","$q","$log","$state","$http","$mdDialog","SalesOrderService","Notification","$stateParams","MRService","POService",function($scope,$q,$log,$state,$http,$mdDialog,SalesOrderService,Notification,$stateParams,MRService,POService){function LoadMRList(data){MRService.get(data).then(function(res){$scope.count=res.data.count,$scope.MRData=res.data.results,$scope.MRGridList.data=[],$scope.showLoader=!1,$scope.MRGridList.data=res.data.results,$scope.MRGridList.data=$scope.MRGridList.data.map(function(item){return item.owner.fullName=item.owner.first_name+" "+item.owner.last_name,item}),$scope.MRGridList.data=_.sortBy($scope.MRGridList.data,"id")})}$scope.currentPage=1,$scope.maxSize=10,$scope.filter={},$scope.selectedMR=[],LoadMRList({page_size:10,page:1}),$scope.params={},$scope.showLoader=!0,$scope.AddMR=function(){$state.go("storeDashboard.materialRequisition.create")},$scope.current_user&&$scope.current_user.data&&SalesOrderService.get({supplier_company_id:$scope.current_user.data.company.id}).then(function(res){$scope.SOList=res.data.results}),$scope.toHelp=function(){$state.go("layout.standard.help.stroes",{type:"material-requistion"})},MRService.getRequestType().then(function(result){$scope.requestType=result.data.results});var selectionCellTemplate='<div class="ngCellText ui-grid-cell-contents" ng-click="grid.appScope.rowClick(row)"><div>{{COL_FIELD}}</div></div>';$scope.MRGridList={enableFiltering:!0,showColumnFooter:!0,rowIdentity:function(row){return row.id},columnDefs:[{name:"id",displayName:"MR#",width:100,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0,cellTemplate:selectionCellTemplate},{name:"created",displayName:"Date",width:100,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0,cellTemplate:selectionCellTemplate},{field:"owner.fullName",displayName:"Requested By",width:150,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0,cellTemplate:selectionCellTemplate},{field:"request_type.name",displayName:"Request Type",width:150,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0,cellTemplate:selectionCellTemplate},{field:"purpose.name",displayName:"Purpose",width:200,pinnedLeft:!0,enableCellEdit:!1,enableSorting:!0,cellTemplate:selectionCellTemplate},{field:"order_reference.so_number",displayName:"Order Reference",width:200,pinnedLeft:!0,enableSorting:!1,enableCellEdit:!1,cellTemplate:selectionCellTemplate},{field:"destination_type.name",displayName:"Destination Type",width:150,pinnedLeft:!0,enableCellEdit:!1,cellTemplate:selectionCellTemplate}]},$scope.EditMR=function(data){return data.length>1?void Notification.error({message:"please select one item",positionX:"right",positionY:"top"}):data.length<1?void Notification.error({message:"please select atleast one item",positionX:"right",positionY:"top"}):void(data&&$state.go("storeDashboard.materialRequisition.edit",{MRId:data[0].id}))},$scope.rowClick=function(row){$state.go("storeDashboard.materialRequisition.view",{MRId:row.entity.id})},$scope.setPage=function(pageNo){$scope.currentPage=pageNo,Object.keys($scope.params).length?($scope.params.page_size=pageNo,$scope.params.page=1,LoadMRList($scope.params)):LoadMRList({page_size:10,page:pageNo})},$scope.clearFilters=function(){$scope.filter={},LoadMRList({page_size:10,page:1})},$scope.selectedValue=function(data,index,value){value?$scope.selectedMR.push(data):$scope.selectedMR.map(function(item,index){item.id===data.id&&($scope.selectedMR.splice(index,1),$scope.selectedMR.length-1)})},$scope.DeleteMR=function(data){return data.length>1?void Notification.error({message:"please select one item",positionX:"right",positionY:"top"}):data.length<1?void Notification.error({message:"please select atleast one item",positionX:"right",positionY:"top"}):void MRService["delete"](data[0].id).then(function(res){Notification.success({message:"successfully deleted",positionX:"right",positionY:"top"}),LoadMRList({page_size:10,page:1})})},$scope.applyFilters=function(data){if($scope.params={},data.date_from){var date=new Date(data.date_from),dateString=new Date(date.getTime()-6e4*date.getTimezoneOffset()).toISOString(),result=dateString.replace(/['"]+/g,"");$scope.params.created__gte=result}if(data.date_to){var date=new Date(data.date_to),dateString=new Date(date.getTime()-6e4*date.getTimezoneOffset()).toISOString(),result=dateString.replace(/['"]+/g,"");$scope.params.created__lte=result}data.so_number&&($scope.params.order_reference__so_number=data.so_number),data.request_type&&($scope.params.request_type__id=data.request_type),$scope.current_user&&$scope.current_user.data.company&&($scope.params.company__id=$scope.current_user.data.company.id),$scope.params.page_size=10,$scope.params.page=1,$scope.MRGridList.data=[],LoadMRList($scope.params)}}])}();