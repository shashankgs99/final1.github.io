"use strict";!function(){angular.module("app").controller("layout.company.controller",["$scope","$window","$location","$http","$timeout","Notification","$stateParams","CompanyService","$anchorScroll","DirectoryService","$filter","$state","$log","MessageService","$sce","s3Service","$rootScope","CommonServices","ParentCategoryService","CategoryService","InventoryService","$mdDialog","UserService","ProjectService",function($scope,$window,$location,$http,$timeout,Notification,$stateParams,CompanyService,$anchorScroll,DirectoryService,$filter,$state,$log,MessageService,$sce,s3Service,$rootScope,CommonServices,ParentCategoryService,CategoryService,InventoryService,$mdDialog,UserService,ProjectService){function loadData(){DirectoryService.getOutput({supplier_company:$stateParams.companyId}).then(function(data){$scope.products=data.data.results,$scope.products.map(function(item){item.image_url=CommonServices.getProductImageUrl(item,parentCategories,allCategories)}),CompanyService.getOne($stateParams.companyId).then(function(data){$scope.companyData=data.data,document.title="Supplierscave-Company Profile"+$stateParams.companyName;var roleNames="-";$scope.companyData.role_type&&$scope.companyData.role_type.length&&($scope.companyData.role_type.map(function(item){$scope.activitiesTwoOptions.map(function(rec){item==rec.id&&(roleNames+=","+rec.label)})}),document.title+=roleNames);var description=""+$scope.companyData.company_name;description=+roleNames,$scope.companyData.natureOfBusiness="Manufacturer",$scope.yearOfEstablishment=new Date(data.data.establishment_year),$scope.companyData.is_buyer="true",$scope.companyData.profit=$filter("currency")($scope.companyData.profit,$scope.companyData.profit_currency+" ",0),$scope.companyData.revenue=$filter("currency")($scope.companyData.revenue,$scope.companyData.revenue_currency+" ",0),$scope.companyData.catalogs&&($scope.catalogNames=[],$scope.companyData.catalogs.forEach(function(item){var catalogAttachment=item.split("/");$scope.catalogNames.push({fileName:catalogAttachment.pop(),filePath:item})})),$scope.companyData.role_type?$scope.companyData.role_type=$scope.companyData.role_type.map(function(item){return{id:item,label:$scope.activitiesTwoOptions.filter(function(type){return type.id===item})[0].label}}):$scope.companyData.role_type=[],$scope.companyData.website&&($scope.companyData.website=$scope.companyData.website.replace("https://","")),$scope.companyData.facebook_url&&($scope.companyData.facebook_url=$scope.companyData.facebook_url.replace("https://","")),$scope.companyData.twitter_url&&($scope.companyData.twitter_url=$scope.companyData.twitter_url.replace("https://","")),$scope.companyData.linkedin_url&&($scope.companyData.linkedin_url=$scope.companyData.linkedin_url.replace("https://","")),$scope.companyData.youtube_url&&($scope.companyData.youtube_url=$scope.companyData.youtube_url.replace("https://",""))},function(err){console.log(err),Notification.error({message:"Company information not found",positionX:"right",positionY:"top"}),$timeout(function(){$window.history.back()},1e3)})}),InventoryService.getOutput({supplier_company:$stateParams.companyId}).then(function(data){$scope.inventories=data.data.results,$scope.inventories.map(function(item){"Rental"===item.stock_or_inventory?(item.image_url=CommonServices.getProductImageUrl(item,parentCategories,allCategories),$scope.rentalProducts.push(item)):(item.image_url=CommonServices.getProductImageUrl(item,parentCategories,allCategories),$scope.inventoryProducts.push(item))})})}function getId(){return $scope.current_user.data.id}function iconFunction(){document.body.scrollTop>50||document.documentElement.scrollTop>50?$scope.showIcon=!0:$scope.showIcon=!1}$scope.params=$stateParams,$scope.rentalProducts=[],$scope.showIcon=!1,$scope.inventoryProducts=[],$scope.$on("companyLogin",function(evt,data){$scope.current_user.token=data.token,$scope.current_user.data=data,$rootScope.$broadcast("companyIntroHeader",{hideHeaderNavigation:!1}),$rootScope.$broadcast("dialogclose")}),$scope.slickConfig={enabled:!0,autoplay:!0,dots:!1,draggable:!1,autoplaySpeed:3e3,method:{},event:{beforeChange:function(event,slick,currentSlide,nextSlide){},afterChange:function(event,slick,currentSlide,nextSlide){}}},$scope.slickConfigLoaded=!1,$scope.slickCurrentIndex1=0,$scope.slickInfinite=!0,$scope.slickConfig2={autoplay:!0,enabled:!0,focusOnSelect:!0,infinite:$scope.slickInfinite,initialSlide:0,slidesToShow:3,slidesToScroll:1,method:{},event:{afterChange:function(event,slick,currentSlide,nextSlide){$scope.slickCurrentIndex1=currentSlide},init:function(event,slick){slick.slickGoTo($scope.slickCurrentIndex1)}}},$stateParams.companyName&&(document.title="Supplierscave-Company Profile"+$stateParams.companyName),$scope.CompanyList=function(){$state.go("layout.standard.companyList.list.views")},$scope.current_user.token||$rootScope.$broadcast("companyIntroHeader",{hideHeaderNavigation:!0}),$scope.trustSrc=function(src){return $sce.trustAsResourceUrl(src)},UserService.getRoleTypes().then(function(roledata){roledata.data.count>0&&($scope.activitiesTwoOptions=roledata.data.results.map(function(item){return{id:item.id,label:item.role_type_name}}))});var parentCategories=[],allCategories=[];$stateParams.companyId&&ParentCategoryService.get().then(function(parCat){parentCategories=parCat.data.results,CategoryService.get({page_size:1e4}).then(function(cats){allCategories=cats.data.results,loadData()})}),$scope.open=function(item,type){if("directory"===type){var pageUrl=$state.href("layout.standard.directory.details",{itemId:item.id},{absolute:!0});window.open(pageUrl,"_blank")}else if("rental"===type){var pageUrl=$state.href("layout.standard.rental.details",{itemId:item.id},{absolute:!0});window.open(pageUrl,"_blank")}else if("inventory"===type){var pageUrl=$state.href("layout.standard.inventory.details",{itemId:item.id},{absolute:!0});window.open(pageUrl,"_blank")}},setInterval(function(){window.pageYOffset<50?angular.element(document.querySelectorAll(".tabs-header-section")).css({position:"relative",transition:"all 1s ease-in-out","-webkit-transition":"all 1s ease-in-out","-moz-transition":"all 1s ease-in-out"}):angular.element(document.querySelectorAll(".tabs-header-section")).css({position:"fixed",top:"0","z-index":"7",transition:"all 1s ease-in-out","-webkit-transition":"all 1s ease-in-out","-moz-transition":"all 1s ease-in-out"})},100),$scope.isSet=function(anchorName){return $scope.anchor===anchorName},$scope.gotoRegister=function(){$state.go("register.options")},$scope.gotoAnchor=function(x){$scope.anchor=x;var newHash=x;$location.hash()!==newHash?($location.hash(x),angular.element(document.querySelectorAll(".tabs-header-section")).css({position:"fixed",top:"0","z-index":"8",transition:"all 1s ease-in-out","-webkit-transition":"all 1s ease-in-out","-moz-transition":"all 1s ease-in-out"})):$anchorScroll()},$scope.enquiryMessage={},$scope.attachment,$scope.addAttachment=function(file){var path="user/"+$scope.current_user.data.id+"/company/message";s3Service.uploadFile(path,file,function(url){console.log("Uploaded file successfully"),$scope.attachment=url,Notification.success({message:"Successfully uploaded file",positionX:"right",positionY:"top"})},function(error){errorCallback(error)})},$scope.sendMessage=function(enquiryMessage){if(!$scope.current_user.data.id)return Notification.error({message:"Please login to contact supplier",positionX:"right",positionY:"top"}),void $scope.companyLogin();if(enquiryMessage.message){enquiryMessage.attachments=[],enquiryMessage.sender=getId(),enquiryMessage.supplier_company_id=$stateParams.companyId,$scope.attachment&&enquiryMessage.attachments.push($scope.attachment),MessageService.post(enquiryMessage).then(function(result){Notification.success({message:"Message Sent",positionX:"right",positionY:"top"}),$timeout(function(){$window.location.reload()},3e3)});var toEmail="info@supplierscave.com";if($scope.companyData.emailid1)toEmail=$scope.companyData.emailid1;else if($scope.companyData.emailid2)toEmail=$scope.companyData.emailid2;else if($scope.companyData.contacts&&$scope.companyData.contacts.length){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=$scope.companyData.contacts[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var con=_step.value;if(con.emailid1){toEmail=con.emailid1;break}if(con.emailid2){toEmail=con.emailid2;break}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}$http.get("/sendgrid/contact-company/",{params:{senderEmail:$scope.current_user.data.email,senderName:$scope.current_user.data.first_name,emailBody:enquiryMessage.message,companyEmail:toEmail,companyName:$scope.companyData.company_name,attachment:$scope.attachment}}).then(function(response){console.log("Success")})["catch"](function(error){console.log(error)})}},$scope.companyLogin=function(ev,data,$index){$mdDialog.show({templateUrl:"assets/js/modules/directory/states/list/views/content/modalpopup/companyLogin.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1,locals:{$dialogScope:{userInfo:$scope.current_user.data}}}).then(function(res){res&&($scope.current_user.token=res.token,$scope.current_user.data=res)})},window.onscroll=function(){iconFunction()}}])}();