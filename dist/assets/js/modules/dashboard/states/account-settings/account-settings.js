"use strict";!function(){var app=angular.module("app");app.controller("accountSettingsController",["$scope","$timeout","$state","s3Service","UserService","$injector","$mdDialog","$window",function($scope,$timeout,$state,s3Service,UserService,$injector,$mdDialog,$window){function currentUser(){UserService.getCurrentUser().then(function(data){if(data.data&&data.data.id){if($scope.current_user.data=data.data,$scope.current_user.data.dashboards&&$scope.current_user.data.dashboards.length&&$scope.current_user.data.dashboards.map(function(record){"Supplier"==record.name&&($scope.current_user.data.is_seller=!0),"Buyer"==record.name&&($scope.current_user.data.is_buyer=!0),"Store"==record.name&&($scope.current_user.data.is_store=!0),"Finance"==record.name&&($scope.current_user.data.is_finance=!0)}),$scope.current_user.data.avatar){var google=$scope.current_user.data.avatar.includes("google"),facebook=$scope.current_user.data.avatar.includes("fbcdn"),linkedin=$scope.current_user.data.avatar.includes("licdn");1==google?$scope.socialIcon="google":1==facebook?$scope.socialIcon="facebook":1==linkedin?$scope.socialIcon="linkedin":$scope.current_user.data.avatar=$scope.current_user.data.image_url}UserService.getRoleTypes().then(function(roledata){roledata.data.count>0&&($scope.rollTypeOptions=roledata.data.results.map(function(item){return{id:item.id,label:item.role_type_name}}))}),$scope.current_user.data.role_type?$scope.current_user.data.role_type=$scope.current_user.data.role_type.map(function(item){return{id:item,label:$scope.rollTypeOptions.filter(function(type){return type.id===item})[0].label}}):$scope.current_user.data.role_type=[],$scope.dropdownSettings={scrollableHeight:"200px",scrollable:!0,smartButtonMaxItems:3,smartButtonTextConverter:function(itemText,originalItem){return itemText}}}})["catch"](function(response){})}$scope.generalInfo=!1,$scope.addressInfo=!1,$scope.signatureInfo=!1,$scope.companyInfo=!1,$scope.cancel=function(){$mdDialog.cancel()},$scope.editAccoountProfile=function(ev,type){var accountDetails=$scope.current_user.data;$mdDialog.show({controller:"accountSettingEditController",templateUrl:"assets/js/modules/dashboard/states/account-settings/account-setting-edit.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,locals:{$dialogScope:{type:type,finalData:accountDetails}}}).then(function(res){$scope.current_user.data=res,$timeout(function(){$window.location.reload()},1e3)},function(){})},$scope.editProfile=function(){$state.go($state.$current.parent.name+".edit",{reload:!0})},$scope.tinymceOptions={plugins:"link image code media table paste",toolbar:"undo redo | bold italic | alignleft aligncenter alignright | code"},$scope.FileUpload=function(file){var type="profile",path="user/"+$scope.current_user.data.id+"/company/"+type;s3Service.uploadFile(path,file,function(url){$scope.current_user.data.image_url=url;var Notification=$injector.get("Notification");Notification.success({message:"Profile picture uploaded successfully",positionX:"right",positionY:"top"}),console.log("Uploaded file successfully")},function(error){errorCallback(error)})},$scope.cancelEditAccount=function(){$state.go($state.$current.parent.name+".view",{reload:!0})},$scope.updateUserAccount=function(data){var roles=[];if(data.role_type&&data.role_type.length&&(data.role_type=data.role_type.map(function(item){item&&roles.push(item.id)})),data.role_type=roles,data.company&&(data.company=data.company.company_name),data.avatar){var google=data.avatar.includes("google"),facebook=data.avatar.includes("fbcdn"),linkedin=data.avatar.includes("licdn");1==google?$scope.socialIcon="google":1==facebook?$scope.socialIcon="facebook":1==linkedin?$scope.socialIcon="linkedin":data.avatar=data.image_url}delete data.password,UserService.update(data.id,data).then(function(data){$scope.success=!0,console.log("data saved");var Notification=$injector.get("Notification");Notification.success({message:"Data saved successfully",positionX:"right",positionY:"top"}),$timeout(function(){$state?(currentUser(),$state.go($state.$current.parent.name+".view",{reload:!0})):currentUser()},3e3)},function(err){$scope.error=err.data,console.log(err)})},currentUser()}])}();