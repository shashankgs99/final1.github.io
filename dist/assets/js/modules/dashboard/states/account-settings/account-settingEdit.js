"use strict";!function(){var app=angular.module("app");app.controller("accountSettingEditController",["$scope","$timeout","$state","s3Service","UserService","$injector","$mdDialog","$dialogScope",function($scope,$timeout,$state,s3Service,UserService,$injector,$mdDialog,$dialogScope){$scope.generalInfo=!1,$scope.addressInfo=!1,$scope.signatureInfo=!1,$scope.companyInfo=!1,$scope.profileInfo=!1,$scope.type=$dialogScope.type,$scope.rollTypeOptions=[],UserService.getRoleTypes().then(function(roledata){$scope.rollTypeOptions=roledata.data.results,$scope.data=angular.copy($dialogScope.finalData);var data=$scope.data.role_type;$scope.data.role_type=[],data.map(function(item){$scope.rollTypeOptions.map(function(info){item.id==info.id&&$scope.data.role_type.push(info)})}),$scope.data.role_type=_.uniq($scope.data.role_type,"id")}),"update_prfile"==$scope.type&&($scope.generalInfo=!1,$scope.addressInfo=!1,$scope.signatureInfo=!1,$scope.companyInfo=!1,$scope.profileInfo=!0),"general"==$scope.type&&($scope.generalInfo=!0,$scope.addressInfo=!1,$scope.signatureInfo=!1,$scope.companyInfo=!1),"address"==$scope.type&&($scope.generalInfo=!1,$scope.addressInfo=!0,$scope.signatureInfo=!1,$scope.companyInfo=!1),"companyinformation"==$scope.type&&($scope.generalInfo=!1,$scope.addressInfo=!1,$scope.signatureInfo=!1,$scope.companyInfo=!0),"signature"==$scope.type&&($scope.generalInfo=!1,$scope.addressInfo=!1,$scope.signatureInfo=!0,$scope.companyInfo=!1),$scope.tinymceOptions={plugins:"link image code media table paste",toolbar:"undo redo | bold italic | alignleft aligncenter alignright | code",format:"text"},$scope.FileUpload=function(file){var type="profile",path="user/"+$scope.data.id+"/company/"+type;s3Service.uploadFile(path,file,function(url){$scope.data.image_url=url;var Notification=$injector.get("Notification");Notification.success({message:"Profile picture uploaded successfully",positionX:"right",positionY:"top"}),console.log("Uploaded file successfully")},function(error){errorCallback(error)})},$scope.updateUserAccount=function(data){if(data.dashboards.length&&(data.dashboards=data.dashboards.map(function(item){return item.id})),data.is_seller)data.dashboards.push(1);else{var index=data.dashboards.indexOf(1);index>-1&&data.dashboards.splice(index,1)}if(data.is_buyer)data.dashboards.push(2);else{var index=data.dashboards.indexOf(2);index>-1&&data.dashboards.splice(index,1)}if(data.is_store)data.dashboards.push(5);else{var index=data.dashboards.indexOf(5);index>-1&&data.dashboards.splice(index,1)}data.dashboards=_.uniq(data.dashboards);var roles=[];data.role_type&&data.role_type.length&&(data.role_type=data.role_type.map(function(item){item&&roles.push(item.id)})),data.role_type=roles,data.company&&(data.company=data.company.company_name),data.supplier&&(data.supplier=data.supplier.id),delete data.password,UserService.update(data.id,data).then(function(data){$scope.success=!0,console.log("data saved");var Notification=$injector.get("Notification");Notification.success({message:"Data saved successfully",positionX:"right",positionY:"top"}),$mdDialog.hide(data.data)},function(err){$scope.error=err.data,console.log(err)})},$scope.cancel=function(){$mdDialog.cancel()}}])}();