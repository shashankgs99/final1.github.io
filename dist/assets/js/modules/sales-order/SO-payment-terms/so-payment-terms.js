"use strict";!function(){var app=angular.module("app");app.controller("SO.Payment.Controller",["$scope","$q","$log","$state","$http","$mdDialog","dateService","Notification","$stateParams","SalesOrderService","$dialogScope","CsvService","CompanyService","UserService",function($scope,$q,$log,$state,$http,$mdDialog,dateService,Notification,$stateParams,SalesOrderService,$dialogScope,CsvService,CompanyService){function SaveInstallmentData(id){var totalInstallments=[];$scope.installmentsData=$scope.installmentsData.map(function(item){item.payment_terms=id,item.id?SalesOrderService.updatePaymentInstallments(item.id,item).then(function(res){totalInstallments.push(res.data),totalInstallments.length==$scope.installmentsData.length&&($scope.disablePayments=!1,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"}),$mdDialog.cancel())}):SalesOrderService.postPaymentInstallments(item).then(function(res){totalInstallments.push(res.data),totalInstallments.length==$scope.installmentsData.length&&($scope.disablePayments=!1,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"}),$mdDialog.cancel())})})}$scope.installmentsData=[],$scope.uploadedInstallments=[],$scope.enteredInstallments=[],$scope.payment={},SalesOrderService.getPaymentTerms({soId:$dialogScope.so.id}).then(function(data){$scope.payment=data.data.results[0],data.data.results.length?SalesOrderService.getInstallments({soId:$scope.payment.id}).then(function(res){$scope.uploadedInstallments=res.data.results}):Object.keys($dialogScope.paymentData).length&&($scope.payment=$dialogScope.paymentData,$scope.enteredInstallments=$dialogScope.installmentsData)}),$scope.SavePayments=function(data){return data.description?(data.heading="Payment Terms",data.so=$dialogScope.so.id,void(data&&data.id?SalesOrderService.updatePaymentTerms(data.id,data).then(function(data){var id=data.data.id;$scope.installmentsData.length&&!$scope.installmentsData.entered?SaveInstallmentData(id):($scope.disablePayments=!1,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"}),$mdDialog.cancel())}):SalesOrderService.postPaymentTerms(data).then(function(data){var id=data.data.id;$scope.installmentsData.length&&!$scope.installmentsData.entered?SaveInstallmentData(id):($scope.disablePayments=!1,Notification.success({message:"successfully saved",positionX:"right",positionY:"top"}),$mdDialog.cancel())}))):void Notification.error({message:"Description is mandatory",positionX:"right",positionY:"top"})},$scope.installmentTerms=function(ev){var data=null;$scope.installmentsData.length&&(data=$scope.installmentsData),$scope.enteredInstallments.length&&(data=$scope.enteredInstallments),$scope.uploadedInstallments.length&&(data=$scope.uploadedInstallments),$mdDialog.show({controller:"annexure.one",templateUrl:"assets/js/modules/po/orders/create-orders/installmentterms.html",parent:angular.element(document.body),multiple:!0,targetEvent:ev,clickOutsideToClose:!0,locals:{$dialogScope:{uploadedInfo:data,total:$dialogScope.so.price_number}}}).then(function(data){data&&($scope.installmentsData=[],data.deleted&&($scope.deletedInstallmentsData=data.deleted,delete data.deleted),$scope.installmentsData=data)})},$scope.cancel=function(){var data={};data.payment=$scope.payment,data.installments=$scope.installmentsData,$mdDialog.hide(data)}}])}();