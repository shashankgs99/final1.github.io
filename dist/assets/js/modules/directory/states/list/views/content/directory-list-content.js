"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}!function(){var app=angular.module("app");app.controller("directory.list.content.controller",["$scope","$rootScope","$window","$timeout","DirectoryService","$modal","$log","MessageService","$stateParams","Notification","InventoryService","CategoryService","ParentCategoryService","s3Service","UserService","$http","CommonServices","$state",function($scope,$rootScope,$window,$timeout,DirectoryService,$modal,$log,MessageService,$stateParams,Notification,InventoryService,CategoryService,ParentCategoryService,s3Service,UserService,$http,CommonServices,$state){function getUserData(){return $scope.current_user.data}function initSearch(){var rentalFacet=$stateParams.inventory?$stateParams.rental?["Rental"]:["-Rental"]:[],search=instantsearch(_defineProperty({appId:appId,apiKey:apiKey,indexName:$stateParams.inventory?"Inventory":"Directory",routing:!0,searchParameters:{facetsRefinements:{hide_data:[!1],stock_or_inventory:rentalFacet},facets:["hide_data","stock_or_inventory"]}},"routing",{router:instantsearch.routers.history({windowTitle:function(routeState){var title="";title+=$stateParams.inventory?$stateParams.rental?"Rental List":"Inventory List":"Directory List",routeState.categories&&(title+=" of "+routeState.categories),routeState.locations&&(title+=" in "+routeState.locations),routeState.suppliers&&(title+=" listed by "+routeState.suppliers),routeState.dirSuppliers&&(title+=" listed by "+routeState.dirSuppliers);var keywords=[];return routeState.categories&&keywords.push(routeState.categories),routeState.suppliers&&keywords.push(routeState.suppliers),$rootScope.custom_title=title,$rootScope.custom_meta_description=title,$rootScope.custom_meta_keywords=keywords,title}}),stateMapping:{stateToRoute:function(uiState){return{query:uiState.query&&uiState.query.replace(/ /g,"-"),categories:uiState.hierarchicalMenu&&uiState.hierarchicalMenu["categories.lvl0"]&&uiState.hierarchicalMenu["categories.lvl0"].join("~").replace(/ /g,"-"),locations:uiState.hierarchicalMenu&&uiState.hierarchicalMenu["cities.lvl0"]&&uiState.hierarchicalMenu["cities.lvl0"].join("~").replace(/ /g,"-"),suppliers:uiState.refinementList&&uiState.refinementList["supplier_obj.supplier"]&&uiState.refinementList["supplier_obj.supplier"].join("~").replace(/ /g,"-"),dirSuppliers:uiState.refinementList&&uiState.refinementList.supplier_name&&uiState.refinementList.supplier_name.join("~").replace(/ /g,"-"),manufacturers:uiState.refinementList&&uiState.refinementList.manufacturer_name&&uiState.refinementList.manufacturer_name.join("~").replace(/ /g,"-"),itemTypes:uiState.refinementList&&uiState.refinementList.stock_or_inventory&&uiState.refinementList.stock_or_inventory.join("~").replace(/ /g,"-"),page:uiState.page}},routeToState:function(routeState){return{query:routeState.query&&routeState.query.replace(/-/g," "),refinementList:{"categories.lvl0":routeState.categories&&routeState.categories.replace(/-/g," ").split("~"),"cities.lvl0":routeState.locations&&routeState.locations.replace(/-/g," ").split("~"),stock_or_inventory:routeState.itemTypes&&routeState.itemTypes.replace(/-/g," ").split("~"),manufacturer_name:routeState.manufacturers&&routeState.manufacturers.replace(/-/g," ").split("~"),"supplier_obj.supplier":routeState.suppliers&&routeState.suppliers.replace(/-/g," ").split("~"),supplier_name:routeState.dirSuppliers&&routeState.dirSuppliers.replace(/-/g," ").split("~")},page:routeState.page}}}}));search.addWidget(instantsearch.widgets.searchBox({container:"#search-box",placeholder:"Search for products"})),search.addWidget(instantsearch.widgets.stats({container:"#stats-container"})),search.addWidget(instantsearch.widgets.hierarchicalMenu({container:"#hierarchical-categories",attributes:["categories.lvl0","categories.lvl1","categories.lvl2","categories.lvl3"],templates:{header:"Categories"}})),search.addWidget(instantsearch.widgets.hierarchicalMenu({container:"#hierarchical-cities",attributes:["cities.lvl0","cities.lvl1","cities.lvl2"],templates:{header:"Location"}})),"inventory"===$scope.itemType||"rental"===$scope.itemType?(search.addWidget(instantsearch.widgets.refinementList({container:"#refinement-supplier-inv",attributeName:"supplier_obj.supplier",templates:{header:"Supplier"}})),"inventory"===$scope.itemType&&search.addWidget(instantsearch.widgets.refinementList({container:"#refinement-itemtype",attributeName:"stock_or_inventory",templates:{header:"Item Type"}}))):search.addWidget(instantsearch.widgets.refinementList({container:"#refinement-supplier",attributeName:"supplier_name",templates:{header:"Supplier"}})),search.addWidget(instantsearch.widgets.refinementList({container:"#refinement-manufacturer",attributeName:"manufacturer_name",templates:{header:"Manufacturer"}})),search.addWidget(instantsearch.widgets.hits({container:"#hits",templates:{empty:getNoResultsTemplate(),item:getTemplate("hit")},transformData:{item:function(_item){if(_item.breadCrumbs=getCategoryBreadcrumb(_item),_item.imageUrl=CommonServices.getProductImageUrl(_item,parentCategories,allCategories),_item.location=getLocation(_item),_item.supplier_obj&&_item.supplier_obj.company_id?_item.supplier_link="#":($stateParams.inventory&&(_item.supplier_obj={},_item.supplier_obj.supplier="SuppliersCave"),_item.supplier_link="#"),_item.currency="AED"==_item.currency?"د.إ":"INR"==_item.currency?"₹":"USD"==_item.currency?"$":null,_item.currency&&(_item.unit_price||_item.unit_price_final))if(_item.discount){var unit_price=_item.unit_price_final?_item.unit_price_final:_item.unit_price;unit_price-=unit_price*_item.discount/100,unit_price=Math.floor(unit_price),_item.product_price=_item.currency+" "+unit_price,_item.actual_price=_item.currency+" "+_item.unit_price_final,_item.discount_text=_item.discount+"% Off"}else _item.product_price=_item.currency+" "+(_item.unit_price_final?_item.unit_price_final:_item.unit_price);else _item.product_price="N/A";return _item}},hitsPerPage:6})),search.on("render",function(){var $targetList=angular.element(document.querySelectorAll(".products-section .selectItem"));$targetList.bind("click",function(ev){var checked=ev.target.checked,id=ev.currentTarget.getElementsByClassName("hitObjectId")[0];checked||($scope.selectedProducts=$scope.selectedProducts.filter(function(item){return item.id!=parseInt(id.innerText)})),checked&&id&&id.innerText&&($stateParams.inventory?InventoryService.getOne(parseInt(id.innerText)).then(function(inventory){$scope.selectedProducts.push(inventory.data)}):DirectoryService.getOne(parseInt(id.innerText)).then(function(directory){$scope.selectedProducts.push(directory.data)}))});var $targetListItems=angular.element(document.querySelectorAll(".products-section .hit"));$targetListItems.bind("click",function(ev){var id=parseInt(ev.currentTarget.getElementsByClassName("hitObjectId")[0].innerText);(id||id.innerText)&&($stateParams.inventory?InventoryService.getOne(parseInt(id)).then(function(inventory){inventory.data.product_images&&inventory.data.product_images.length||(inventory.data.product_images=[{s3_url:CommonServices.getProductImageUrl(inventory.data,parentCategories,allCategories)}]),open("large",inventory.data)}):DirectoryService.getOne(parseInt(id)).then(function(directory){directory.data.product_images&&directory.data.product_images.length||(directory.data.product_images=[{s3_url:CommonServices.getProductImageUrl(directory.data,parentCategories,allCategories)}]),open("large",directory.data)}))})}),search.addWidget(instantsearch.widgets.pagination({container:"#pagination",scrollTo:"#search-box"})),search.addWidget(instantsearch.widgets.clearAll({container:"#clear-all",templates:{link:"Clear all"},autoHideContainer:!1,clearsQuery:!1,excludeAttributes:["hide_data","stock_or_inventory"]})),search.start()}function getTemplate(templateName){var messageElem=angular.element(document.querySelector("#hitTemplate"));return messageElem.contents()[0].data}function getNoResultsTemplate(){var messageElem=angular.element(document.querySelector("#no-results-template"));return messageElem.contents()[0].data}function getCategoryBreadcrumb(item){$scope.selectedProducts=[];var highlightValues=[];item.category_name&&highlightValues.push(item.category_name),item.sub_category&&highlightValues.push(item.sub_category),item.sub_sub_category&&highlightValues.push(item.sub_sub_category),item.sub_sub_sub_category&&highlightValues.push(item.sub_sub_sub_category);var breadCrumbs=highlightValues.map(function(category){return category}).join(" > ");return breadCrumbs}function getLocation(item){var location="";return item.city_name&&(location=location+item.city_name+", "),item.state&&(location=location+item.state+", "),item.country&&(location+=item.country),location}function sendEnquiry(size,message){return Object.keys($scope.current_user.data).length?void(message.length?message.forEach(function(item,$index){if(item.supplier_company){var supplier=item.supplier_company.company_name;UserService.getCompanyEmail({company:supplier}).then(function(res){res.data&&res.data.length?item.supplierEmail=res.data[0]:item.supplierEmail="info@supplierscave.com",$index===message.length-1&&openEnquiryDialog(size,message)})}else item.supplierEmail="info@supplierscave.com",$index===message.length-1&&openEnquiryDialog(size,message)}):0==message.length?Notification.error({message:"Please Select Atleast One Item to Send Enquiry",positionX:"right",positionY:"top"}):message.supplier_company?UserService.getCompanyEmail({company:message.supplier_company.company_name}).then(function(res){res.data&&res.data.length?message.supplierEmail=res.data[0]:message.supplierEmail="info@supplierscave.com",openEnquiryDialog(size,message)}):(message.supplierEmail="info@supplierscave.com",openEnquiryDialog(size,message))):void Notification.error({message:"Please Login to send enquiry",positionX:"right",positionY:"top"})}function openEnquiryDialog(size,message,tabCount,itemCount,closeOnClick){var params={templateUrl:"sendEnquiryNestedPopUp.html",resolve:{items:function(){return $scope.items}},controller:function($scope,$modalInstance,items){$scope.message=message,$scope.userInfo=getUserData(),$scope.reposition=function(){$modalInstance.reposition()},$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.openNested=function(){open()}}};angular.isDefined(closeOnClick)&&(params.closeOnClick=closeOnClick),angular.isDefined(size)&&(params.size=size);var modalInstance=$modal.open(params);modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})}function open(size,message,backdrop,itemCount,closeOnClick){$scope.message=message,$scope.productItem=message;var params={templateUrl:"viewProductDetailsPopup.html",resolve:{message:message},scope:$scope,controller:"viewProductDetailsController"};angular.isDefined(closeOnClick)&&(params.closeOnClick=closeOnClick),angular.isDefined(size)&&(params.size=size),angular.isDefined(backdrop)&&(params.backdrop=backdrop);var modalInstance=$modal.open(params);modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})}var params={},parentCategories=[],allCategories=[];$scope.selectedProducts=[],$scope.directory_data={};var appId,apiKey;$scope.showInventory=!1,$scope.itemType="directory",$rootScope.custom_title="Directory List",$rootScope.custom_meta_description="Catalogue of Products , services along with the Supplier details",$rootScope.custom_meta_keywords="Directory - Industrial Products & Services , Suppliers",$rootScope.get_custom_title=function(){return $rootScope.custom_title?$rootScope.custom_title:"Supplierscave.com"},$rootScope.get_meta_description=function(){return $rootScope.custom_meta_description?$rootScope.custom_meta_description:"Supplierscave.com"},$rootScope.get_meta_keywords=function(){return $rootScope.custom_meta_keywords?$rootScope.custom_meta_keywords:"Supplierscave.com"},$stateParams.inventory&&($scope.itemType="inventory",$stateParams.rental?$scope.showInventory=!1:$scope.showInventory=!0,$rootScope.custom_title="Inventory List",$rootScope.custom_meta_description="Summary of Inventory of Stock / Surplus / Used / Scrap",$rootScope.custom_meta_keywords="Summary of Inventory - Stock, Surplus, used , scrap - Industrial Products & Services , Suppliers"),$stateParams.rental&&($scope.itemType="rental",$rootScope.custom_title="Rental List",$rootScope.custom_meta_description="Summary of Rental Items",$rootScope.custom_meta_keywords="Rental, Suppliers"),ParentCategoryService.get().then(function(parCat){parentCategories=parCat.data.results,CategoryService.get({page_size:1e4}).then(function(cats){allCategories=cats.data.results,$http.get("/backend/get-aloglia-keys/").then(function(response){appId=response.data.appId,apiKey=response.data.apiKey,initSearch()})})}),$stateParams.category&&(params.category_name=$stateParams.category),$stateParams.city&&(params.city=$stateParams.city),$stateParams.country&&(params.country=$stateParams.country),$stateParams.state&&(params.state=$stateParams.state),$scope.sendEnquiry=sendEnquiry,$scope.open=open,$scope.Output=function(){$stateParams.rental?$state.go("layout.standard.rental.output"):$state.go("layout.standard.inventory.output")}}]).directive("descriptionContent",function(){return{restrict:"A",link:function(scope,element,attrs){element.ready(function(){var height;height=element[0].offsetHeight,height>=210&&(scope.anchorSettings={showAnchor:!0,readMoreText:!0},scope.fullWidth=function(){scope.anchorSettings.readMoreText=!scope.anchorSettings.readMoreText})})}}})}();