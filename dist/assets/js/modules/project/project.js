"use strict";!function(){var app=angular.module("app");app.controller("layout.standard.projectController",["$scope","$window","$mdDialog","$log","$state","Notification","DirectoryService","$rootScope","$stateParams","ProjectService",function($scope,$window,$mdDialog,$log,$state,Notification,DirectoryService,$rootScope,$stateParams,ProjectService){function loadProjectData(data){$scope.selectedProject=[],ProjectService.get(data).then(function(data){$scope.count=data.data.count,$scope.projectData=data.data.results,$scope.projectData=_.sortBy($scope.projectData,"created"),$scope.showLoader=!1})}function getCompanyId(){return $scope.current_user&&$scope.current_user.data&&$scope.current_user.data.company?$scope.current_user.data.company.id:void 0}$scope.ownerId=$scope.current_user.data.id,$scope.params={},$scope.currentPage=1,$scope.maxSize=10,$scope.showLoader=!0,loadProjectData({page_size:10,page:1}),$scope.currentPage=1,$scope.maxSize=10,$scope.selectedProject=[],$scope.supplierAccess=!1,$scope.$on("projectFIlters",function(event,data){data&&loadProjectData(data)}),$state.current.name.includes("supplierDashboard")&&($scope.supplierAccess=!0),$scope.setPage=function(pageNo){$scope.currentPage=pageNo,loadProjectData({page_size:10,page:pageNo})},$scope.selectedValue=function(data,index,value){value?$scope.selectedProject.push(data):$scope.selectedProject.map(function(item,index){item.id===data.id&&($scope.selectedProject.splice(index,1),$scope.selectedProject.length-1)})},$scope.addProject=function(){$state.current.name.includes("adminDashboard")?$state.go("adminDashboard.projects.create"):$state.go("supplierDashboard.projects.create")},$stateParams.clientId&&($scope.params={},1==$stateParams.type?$scope.params.customer_contractor=$stateParams.clientId:$scope.params.customer_client=$stateParams.clientId),$scope.editProject=function(data){return data.length>1?void Notification.error({message:"please select one item",positionX:"right",positionY:"top"}):data.length<1?void Notification.error({message:"please select atleast one item",positionX:"right",positionY:"top"}):void($state.current.name.includes("adminDashboard")?$state.go("adminDashboard.projects.edit",{projectId:data[0].id}):$state.go("supplierDashboard.projects.edit",{projectId:data[0].id}))},$scope.ViewProject=function(data){$state.go("supplierDashboard.projects.view",{projectId:data.id})},$scope.deleteProject=function(data){if(data.length<1)return void Notification.error({message:"please select atleast one item",positionX:"right",positionY:"top"});var list=[];data.map(function(item){ProjectService["delete"](data[0].id).then(function(res){list.push(res.data),list.length==data.length&&(Notification.success({message:"Successfully deleted",positionX:"right",positionY:"top"}),loadProjectData({page_size:10,page:1}),$scope.selectedProject=[])})})},$scope.cancelEdit=function(){$state.current.name.includes("adminDashboard")?$state.go("adminDashboard.projects.list"):$state.go("supplierDashboard.projects.list")},$scope.makeOffer=function(ev,record,data){record=record[0];var companyId=getCompanyId();return companyId?record.length>1?void Notification.error({message:"please select one item",positionX:"right",positionY:"top"}):record.length<1?void Notification.error({message:"please select atleast one item",positionX:"right",positionY:"top"}):void $mdDialog.show({controller:"manage.offerDialogController",templateUrl:"assets/js/modules/manage-offers/offer-modal.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,multiple:!0,locals:{$dialogScope:{project:record.id,supplier:companyId,userData:$scope.current_user.data}}}).then(function(res){loadProjectData({page_size:10,page:1}),$scope.selectedProject=[]},function(){}):void Notification.error({message:"Register as supplier-admin to create offer",positionX:"right",positionY:"top"})}}])}();