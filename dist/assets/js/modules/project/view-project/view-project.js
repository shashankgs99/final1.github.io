"use strict";!function(){angular.module("app").controller("layout.ViewProjectController",["$scope","$window","$modal","$log","$state","Notification","$http","s3Service","OfferService","$rootScope","$stateParams","$mdDialog","$q","ProjectService",function($scope,$window,$modal,$log,$state,Notification,$http,s3Service,OfferService,$rootScope,$stateParams,$mdDialog,$q,ProjectService){function loadOffers(){var params={};params.enquiry__project__name=$scope.project.name,OfferService.getOfferSent(params).then(function(data){data.data.results&&data.data.results.length&&($scope.view=!0)})}$scope.fullName=[],$scope.attachments=[],$scope.view=!1,ProjectService.getOne($stateParams.projectId).then(function(data){$scope.project=data.data,loadOffers(),$scope.project.customer_contacts.length&&($scope.project.customer_contacts=$scope.project.customer_contacts.map(function(item){var name;return item.firstname&&(name=item.firstname),item.lastname&&(name+=item.lastname),name&&(item.fullName=name),item}))}),ProjectService.getProjectStatus().then(function(item){$scope.projectStatus=item.data.results}),$scope.viewOffers=function(){var params={};params.enquiry__project__name=$scope.project.name,$rootScope.$broadcast("offersData",$scope.params)},$scope.makeOffer=function(ev,record){return $scope.current_user&&$scope.current_user.data&&!$scope.current_user.data.company?void Notification.error({message:"Register as supplier-admin to create offer",positionX:"right",positionY:"top"}):void $mdDialog.show({controller:"manage.offerDialogController",templateUrl:"assets/js/modules/manage-offers/offer-modal.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,multiple:!0,locals:{$dialogScope:{project:record.id,supplier:$scope.current_user.data.company.id,userData:$scope.current_user.data}}}).then(function(res){loadOffers()},function(){})},$scope.BackToList=function(){$state.go("supplierDashboard.projects.list")},$scope.EditProject=function(data){$state.go("supplierDashboard.projects.edit",{projectId:data.id})}}])}();